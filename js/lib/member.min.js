"use strict";function sleep(time){return new Promise(resolve=>setTimeout(resolve,time))}function timeSince(timestamp,compress){let date=new Date(1e3*timestamp);var seconds=Math.floor((new Date-date)/1e3),interval=Math.floor(seconds/31536e3);return interval>1?___i18n("%s years ago",interval):(interval=Math.floor(seconds/2592e3))>1?___i18n("%s months ago",interval):(interval=Math.floor(seconds/86400))>1?___i18n(compress?"%s d":"%s days ago",interval):(interval=Math.floor(seconds/3600))>1?___i18n(compress?"%s h":"%s hours ago",interval):(interval=Math.floor(seconds/60))>1?___i18n(compress?"%s m":"%s minutes ago",interval):___i18n(compress?"%s s":"%s seconds ago",Math.floor(seconds))}var getJSON=function(url){return updateStatus("loading "+url),new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;addListeners(xhr),xhr.open("get",url,!0),xhr.responseType="json",xhr.onerror=function(e){4==XMLHttpRequest.readyState?reject("Error HTTP: "+XMLHttpRequest.statusText):0==XMLHttpRequest.readyState?reject("Error:"+XMLHttpRequest.statusText):reject("Error.")},xhr.onload=function(){var status=xhr.status;200==status?resolve(xhr.response):reject(status)},xhr.send()})};function addListeners(xhr){xhr.addEventListener("loadstart",handleEvent),xhr.addEventListener("load",handleEvent),xhr.addEventListener("progress",handleEvent),xhr.addEventListener("abort",handleEvent)}function handleEvent(e){updateStatus(`${e.type}: ${e.loaded} bytes transferred\n`)}function ds(input){try{input=(input=(input=(input=(input=input.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")).replace(/'/g,"&#x27;")}catch(e){return""}return input}function updateStatus(message){document.getElementById("status").innerHTML=message}function toHexString(byteArray){return Array.from(byteArray,function(byte){return("0"+(255&byte).toString(16)).slice(-2)}).join("")}function san(input){return sanitizeAlphanumeric(input)}function sanitizeAlphanumeric(input){return void 0===input||null==input?"":(input+="").replace(/[^A-Za-z0-9]/g,"")}function sanyoutubeid(input){return null==input?"":input.replace(/[^A-Za-z0-9\-_]/g,"")}function unicodeEscape(str){if(void 0==str)return"";for(var charCode,escape,result="",index=0;!isNaN(charCode=str.charCodeAt(index++));)escape=charCode.toString(16),result+=charCode<256?"\\x"+(charCode>15?"":"0")+escape:"\\u"+("0000"+escape).slice(-4);return result}function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}function getHeight(){var myHeight=0;return"number"==typeof window.innerWidth?(window.innerWidth,myHeight=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(document.documentElement.clientWidth,myHeight=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(document.body.clientWidth,myHeight=document.body.clientHeight),myHeight}function getWidth(){var myWidth=0;return"number"==typeof window.innerWidth?(myWidth=window.innerWidth,window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(myWidth=document.documentElement.clientWidth,document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(myWidth=document.body.clientWidth,document.body.clientHeight),myWidth}function getParameterByName(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}function scrollTo(name){var element=document.getElementById(name);void 0!=element&&ScrollToResolver(element)}function ScrollToResolver(elem){var jump=parseInt(.2*elem.getBoundingClientRect().top);document.body.scrollTop+=jump,document.documentElement.scrollTop+=jump,!elem.lastjump||elem.lastjump>Math.abs(jump)?(elem.lastjump=Math.abs(jump),setTimeout(function(){ScrollToResolver(elem)},"100")):elem.lastjump=null}function localStorageGet(theSO,itemName){try{return theSO.getItem(itemName)}catch(err){return null}}function localStorageSet(theSO,itemName,theString){try{return theSO.setItem(itemName,theString),!0}catch(err){return!1}}String.prototype.contains=function(segment){return-1!==this.indexOf(segment)};var simplemde,usdrate=266.75;function getLatestUSDrate(){getJSON("https://api.coinmarketcap.com/v1/ticker/bitcoin-cash/").then(function(data){updateStatus("Got updated exchange rate:"+(usdrate=Number(data[0].price_usd)));try{tq.updateBalance()}catch(err){}},function(status){console.log("Failed to get usd rate:"+status),updateStatus(status)})}function balanceString(total,includeSymbol){if("BCH"==dropdowns.currencydisplay){var balString=(Number(total)/1e3).toFixed(3);return balString=Number(balString.substr(0,balString.length-4)).toLocaleString()+"<span class='sats'>"+balString.substr(balString.length-3,3)+"</span>",includeSymbol?"₿"+balString:balString+" sats "}var usd=(Number(total)*usdrate/1e8).toFixed(2);return usd<1?(100*usd).toFixed(0)+"¢":"$"+usd}function detectMultipleIDS(){var i,len,id,elms=document.getElementsByTagName("*"),ids={};for(i=0,len=elms.length;i<len;i+=1)(id=elms[i].id||null)&&(ids[id]=ids.hasOwnProperty(id)?ids[id]+=1:0);for(id in ids)ids.hasOwnProperty(id)&&ids[id]&&console.warn("Multiple IDs #"+id)}function listenForTwitFrameResizes(){document.querySelectorAll("*[id^='tweet_']").forEach(element=>{element.onload=function(){this.contentWindow.postMessage({element:this.id,query:"height"},"https://twitframe.com")}})}function getAndPopulateNew(order,content,topicnameHOSTILE,filter,start,limit,page,qaddress){""==order&&(order="hot"),""==content&&(content="posts"),""==filter&&(filter="everyone"),""==start&&(start=0),""==limit&&(limit=numbers.results),""==page&&(page="posts"),show(page),document.getElementById(page).innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action=show&order="+order+"&content="+content+"&topicname="+encodeURIComponent(topicnameHOSTILE)+"&filter="+filter+"&address="+qaddress+"&start="+start+"&limit="+limit).then(function(data){var navbuttons=getNavButtonsNewHTML(order,content,topicnameHOSTILE,filter,start,limit,page,qaddress,"getAndPopulateNew",data.length);data=mergeRepliesToRepliesBySameAuthor(data=removeDuplicates(data));for(var contents="",i=0;i<data.length;i++)contents+=getPostListItemHTML(getHTMLForPost(data[i],i+1+start,page,i,null));displayItemListandNavButtonsHTML(contents,navbuttons,page,data,"posts",start)},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function getAndPopulate(start,limit,page,qaddress,type,topicNameHOSTILE){console.log("deprecated getAndPopulate old called"),""==type&&(type="all"),show(page),document.getElementById(page).innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action="+page+"&topicname="+encodeURIComponent(topicNameHOSTILE)+"&address="+pubkey+"&type="+type+"&qaddress="+qaddress+"&start="+start+"&limit="+limit).then(function(data){var navbuttons=getNavButtonsHTML(start,limit,page,type,qaddress,topicNameHOSTILE,"getAndPopulate",data.length);data=mergeRepliesToRepliesBySameAuthor(data=removeDuplicates(data));for(var contents="",i=0;i<data.length;i++)contents+=getPostListItemHTML(getHTMLForPost(data[i],i+1+start,page,i,null));displayItemListandNavButtonsHTML(contents,navbuttons,page,data,"posts",start)},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function getAndPopulateThread(roottxid,txid,pageName){"mapthread"!=pageName&&(show(pageName),document.getElementById(pageName).innerHTML=document.getElementById("loading").innerHTML),void 0!==txid&&""!=txid||(txid=roottxid),getJSON(dropdowns.contentserver+"?action=thread&address="+pubkey+"&txid="+txid).then(function(data){(data=mergeRepliesToRepliesBySameAuthor(data=removeDuplicates(data))).length>0&&(roottxid=data[0].roottxid),setTopic(data[0].topic);for(var threadstarter=null,i=0;i<data.length;i++)data[i].txid==roottxid&&(threadstarter=data[i].address);var earliestReply="none",earliestReplyTXID="none",earliestReplyTime=9999999999;for(i=0;i<data.length;i++)data[i].retxid==roottxid&&data[i].address==threadstarter&&data[i].firstseen<earliestReplyTime&&(earliestReply=i,earliestReplyTime=data[i].firstseen,earliestReplyTXID=data[i].txid);var contents="";for(i=0;i<data.length;i++)data[i].txid==roottxid&&(contents+=getDivClassHTML("fatitem",getHTMLForPost(data[i],1,pageName,i,data[earliestReply])),contents+=getDivClassHTML("comment-tree",getNestedPostHTML(data,data[i].txid,0,pageName,txid,earliestReplyTXID)));displayItemListandNavButtonsHTML(contents,"","thread",data,"",0),void 0!=popup&&popup.setContent("<div id='mapthread'>"+contents+"</div>"),scrollTo("highlightedcomment")},function(status){console.log("Something is wrong:"+status),document.getElementById(pageName).innerHTML="Something is wrong:"+status,updateStatus(status)})}function getAndPopulateTopicList(showpage){var page="topiclistanchor";showpage&&show(page),document.getElementById(page).innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action=topiclist&qaddress="+pubkey).then(function(data){for(var selectboxIndex=5,selectbox=document.getElementById("topicselector");selectbox.options[selectboxIndex];)selectbox.remove(selectboxIndex);for(var lastValue="",i=0;i<40;i++){var option=document.createElement("option");option.text=capitalizeFirstLetter(data[i].topicname.substr(0,13)),option.value=data[i].topicname,option.value!=lastValue&&(lastValue=option.value,selectbox.add(option,[selectboxIndex]),selectboxIndex++)}var contents="<br/><table><tr><td class='tltopicname'>Topic</td><td class='tlmessagescount'>Posts</td><td class='tlsubscount'>Subs</td><td class='tlaction'>Action</td></tr>",modsArray=[];for(i=0;i<data.length;i++)0==i||i<data.length&&data[i].topicname==data[i-1].topicname?modsArray.push(data[i]):(contents+=getHTMLForTopicArray(modsArray),(modsArray=[]).push(data[i]));contents+="</table>",document.getElementById(page).innerHTML=contents},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function displayItemListandNavButtonsHTML(contents,navbuttons,page,data,styletype,start){contents=getItemListandNavButtonsHTML(contents,navbuttons,styletype,start),document.getElementById(page).innerHTML=contents,listenForTwitFrameResizes(),addStarRatings(data,page),window.scrollTo(0,0)}function addStarRatings(data,page,disable){for(var i=0;i<data.length;i++){var theAddress=ds(data[i].address);"reply"!=data[i].type&&"like"!=data[i].type&&"follow"!=data[i].type&&"rating"!=data[i].type&&"page"!=data[i].type||(theAddress=ds(data[i].origin));var querySelector="#rating"+i+page+theAddress;if(addSingleStarsRating(disable,document.querySelector(querySelector)),"reply"==data[i].type||"page"==data[i].type){querySelector="#rating"+i+page+theAddress+data[i].type;addSingleStarsRating(disable,document.querySelector(querySelector))}if("like"==data[i].type){querySelector="#rating"+i+page+(theAddress=ds(data[i].address))+data[i].type;addSingleStarsRating(disable,document.querySelector(querySelector))}}}function addSingleStarsRating(disable,theElement){if(void 0==theElement)return;let name=theElement.dataset.ratingname,theAddress=theElement.dataset.ratingaddress,rawRating=theElement.dataset.ratingraw,starSize=theElement.dataset.ratingsize;var theRating=0;null!=rawRating&&0!=rawRating&&(theRating=ds(rawRating)/64+1);var starRating1=raterJs({starSize:starSize,rating:Math.round(10*theRating)/10,element:theElement,disableText:"This user rates "+ds(name)+" as {rating}/{maxRating}",rateCallback:function(rating,done){var ratingText=document.getElementById("memberratingcommentinputbox"+theAddress);void 0!==ratingText?rateCallbackAction(rating,this,ratingText.value):rateCallbackAction(rating,this),done()}});return starRating1.theAddress=theAddress,disable&&starRating1.disable(),starRating1}function initMarkdownEditor(){(simplemde=new SimpleMDE({element:document.getElementById("newposttamemorandum"),autoDownloadFontAwesome:!1,autosave:{enabled:!0,uniqueId:"MyUniqueID",delay:1e4},forceSync:!0,promptURLs:!0,spellChecker:!1,showIcons:["code","table","strikethrough","heading-1","heading-2","heading-3","quote"],hideIcons:["preview","side-by-side","fullscreen","guide","heading"]})).codemirror.on("change",function(){memorandumPreview()}),memorandumPreview()}function getMemorandumText(){return simplemde.value()}function switchToArticleMode(){setAddonStyle("article.css")}function switchToRegularMode(){setAddonStyle("none.css")}function memorandumPreview(){var name=document.getElementById("settingsnametext").value,time=(new Date).getTime()/1e3;document.getElementById("memorandumpreview").innerHTML=""+getHTMLForPostHTML("000",pubkey,name,1,0,0,time,document.getElementById("memorandumtitle").value,"",document.getElementById("memorandumtopic").value,0,0,null,"MAINRATINGID","000",1,0,null,"preview")+getHTMLForReplyHTML("000",pubkey,name,1,0,0,time,getMemorandumText(),"","page","MAINRATINGID",null,"000",1,null,null,"preview",document.getElementById("memorandumtopic").value)}function getHTMLForPost(data,rank,page,starindex,dataReply){if(checkForMutedWords(data))return"";let mainRatingID=starindex+page+ds(data.address);var retHTML=getHTMLForPostHTML(data.txid,data.address,data.name,data.likes,data.dislikes,data.tips,data.firstseen,data.message,data.roottxid,data.topic,data.replies,data.geohash,page,mainRatingID,data.likedtxid,data.likeordislike,data.repliesroot,data.rating,starindex);return null!=dataReply&&(retHTML+=getHTMLForReply(dataReply,0,page,starindex,null)),retHTML}function getHTMLForReply(data,depth,page,starindex,highlighttxid){if(checkForMutedWords(data))return"";let mainRatingID=starindex+page+ds(data.address);return getHTMLForReplyHTML(data.txid,data.address,data.name,data.likes,data.dislikes,data.tips,data.firstseen,data.message,depth,page,mainRatingID,highlighttxid,data.likedtxid,data.likeordislike,data.blockstxid,data.rating,starindex,data.topic)}function showReplyButton(txid,page,divForStatus){document.getElementById("replybutton"+page+txid).style.display="block",document.getElementById("replytext"+page+txid).value=""}function sendReply(txid,page,divForStatus){if(!checkForPrivKey())return!1;if(0==(replytext=document.getElementById("replytext"+page+txid).value).length)return alert("Nothing to send"),!1;document.getElementById("replybutton"+page+txid).style.display="none",document.getElementById("replystatus"+page+txid).style.display="block",document.getElementById("replycompleted"+page+txid).innerText="";var replytext=document.getElementById("replytext"+page+txid).value;const replyhex=new Buffer(replytext).toString("hex");return sendReplyRaw(privkey,txid,replyhex,0,divForStatus,function(){replySuccessFunction(page,txid)}),!0}function replySuccessFunction(page,txid){document.getElementById("replytext"+page+txid).value="",document.getElementById("replystatus"+page+txid).style.display="none",document.getElementById("replybutton"+page+txid).style.display="block",document.getElementById("replycompleted"+page+txid).innerHTML="Message Sent. "+getRefreshButtonHTML()}function showReplyBox(txid){return""==privkey?(alert(___i18n("log in to reply")),!1):(document.getElementById("reply"+txid).style.display="block",!0)}function decreaseGUILikes(txid){document.getElementById("downvote"+txid).className="votearrowactivateddown rotate180",document.getElementById("downvoteaction"+txid).onclick=null,document.getElementById("upvote"+txid).className="votearrow";var likescount=Number(document.getElementById("likescount"+txid).innerHTML);document.getElementById("likescount"+txid).innerHTML=likescount-1,document.getElementById("score"+txid).innerHTML=likescount-1}function increaseGUILikes(txid){document.getElementById("upvote"+txid).className="votearrowactivated",document.getElementById("upvoteaction"+txid).onclick=null,document.getElementById("downvote"+txid).className="votearrow rotate180";var likescount=Number(document.getElementById("likescount"+txid).innerHTML);document.getElementById("likescount"+txid).innerHTML=likescount+1,document.getElementById("score"+txid).innerHTML=likescount+1}function likePost(txid,tipAddress){if(""==privkey)return alert("You must login to like posts."),!1;if(increaseGUILikes(txid),document.getElementById("score"+txid).className="betweenvotesscoreup",numbers.oneclicktip>=547){var tipscount=Number(document.getElementById("tipscount"+txid).dataset.amount);document.getElementById("tipscount"+txid).innerHTML=balanceString(tipscount+numbers.oneclicktip,!1),document.getElementById("tipscount"+txid).dataset.amount=tipscount+numbers.oneclicktip,sendTipRaw(txid,tipAddress,numbers.oneclicktip,privkey,null)}else sendLike(txid)}function dislikePost(txid,tipAddress){if(""==privkey)return alert("You must login to dislike posts."),!1;decreaseGUILikes(txid),document.getElementById("score"+txid).className="betweenvotesscoredown",sendDislike(txid)}function sendTip(txid,tipAddress,page){if(!checkForPrivKey())return!1;increaseGUILikes(txid),document.getElementById("tipbutton"+page+txid).style.display="none",document.getElementById("tipstatus"+page+txid).style.display="block";var tipAmount=parseInt(document.getElementById("tipamount"+page+txid).value);if(tipAmount<547)return alert("547 (dust+1) is the minimum tip possible"),!1;defaulttip=tipAmount,document.getElementById("tipstatus"+page+txid).value="Sending Tip . . "+tipAmount;var tipscount=Number(document.getElementById("tipscount"+txid).dataset.amount);document.getElementById("tipscount"+txid).dataset.amount=tipscount+tipAmount,document.getElementById("tipscount"+txid).innerHTML=balanceString(tipscount+tipAmount,!1),sendTipRaw(txid,tipAddress,tipAmount,privkey,function(){document.getElementById("tipstatus"+page+txid).value="sent"})}function showTipBox(txid){return""==privkey?(alert("You must login to tip."),!1):(0==document.getElementById("tipamount"+txid).value&&(document.getElementById("tipamount"+txid).value=defaulttip),document.getElementById("tipbox"+txid).style.display="block",!0)}function showMore(show,hide){return document.getElementById(show).style.display="contents",document.getElementById(hide).style.display="none",!0}function topictitleChanged(elementName){0==document.getElementById(elementName+"topic").value.length?(document.getElementById(elementName+"title").maxLength=217,document.getElementById(elementName+"topic").maxLength=Math.max(0,214-document.getElementById(elementName+"title").value.length)):(document.getElementById(elementName+"title").maxLength=Math.max(0,214-document.getElementById(elementName+"topic").value.length),document.getElementById(elementName+"topic").maxLength=Math.max(0,214-document.getElementById(elementName+"title").value.length)),document.getElementById(elementName+"titlelengthadvice").innerHTML="("+document.getElementById(elementName+"title").value.length+"/"+document.getElementById(elementName+"title").maxLength+")",document.getElementById(elementName+"topiclengthadvice").innerHTML="("+document.getElementById(elementName+"topic").value.length+"/"+document.getElementById(elementName+"topic").maxLength+")"}function geopost(lat,long){if(!checkForPrivKey())return!1;var posttext=document.getElementById("newgeopostta").value;if(0==posttext.length)return alert("No Message Body"),!1;var geohash=encodeGeoHash(document.getElementById("lat").value,document.getElementById("lon").value);document.getElementById("newpostgeocompleted").innerText="",document.getElementById("newpostgeobutton").style.display="none",document.getElementById("newpostgeostatus").style.display="block",document.getElementById("newpostgeostatus").value="Posting...",postgeoRaw(posttext,privkey,geohash,"newpostgeostatus",geocompleted)}function post(){if(!checkForPrivKey())return!1;var posttext=document.getElementById("memotitle").value;if(0==posttext.length)return alert("No Message Body"),!1;var topic=document.getElementById("memotopic").value;document.getElementById("newpostcompleted").innerText="",document.getElementById("newpostbutton").style.display="none",document.getElementById("newpoststatus").style.display="block",document.getElementById("newpoststatus").value="Sending Memo...",postRaw(posttext,privkey,topic,"newpoststatus",memocompleted)}function postmemorandum(){if(!checkForPrivKey())return!1;var posttext=document.getElementById("memorandumtitle").value;if(0==posttext.length)return alert("No Title"),!1;var postbody=document.getElementById("newposttamemorandum").value;if(0==postbody.length)return alert("No Message Body"),!1;var topic=document.getElementById("memorandumtopic").value;document.getElementById("newpostmemorandumcompleted").innerText="",document.getElementById("newpostmemorandumbutton").style.display="none",document.getElementById("newpostmemorandumstatus").style.display="block",document.getElementById("newpostmemorandumstatus").value="Sending Title...",postmemorandumRaw(posttext,postbody,privkey,topic,"newpostmemorandumstatus",memorandumpostcompleted)}function memorandumpostcompleted(){document.getElementById("memorandumtitle").value="",document.getElementById("newposttamemorandum").value="",document.getElementById("newpostmemorandumstatus").style.display="none",document.getElementById("newpostmemorandumbutton").style.display="block",document.getElementById("newpostmemorandumcompleted").innerHTML="Message Sent. "}function memocompleted(){document.getElementById("memotitle").value="",document.getElementById("newpoststatus").style.display="none",document.getElementById("newpostbutton").style.display="block",document.getElementById("newpostcompleted").innerHTML="Message Sent. "}function geocompleted(){document.getElementById("newgeopostta").value="",document.getElementById("newpostgeostatus").style.display="none",document.getElementById("newpostgeobutton").style.display="block",document.getElementById("newpostgeocompleted").innerHTML="Message Sent. "}function checkForMutedWords(data){for(var i=0;i<mutedwords.length;i++)if(""!=mutedwords[i]){var checkfor=mutedwords[i].toLowerCase();if(void 0!=data.message&&data.message.toLowerCase().contains(checkfor))return!0;if(void 0!=data.name&&data.name.toLowerCase().contains(checkfor))return!0;if(void 0!=data.address&&data.address.toLowerCase().contains(checkfor))return!0;if(void 0!=data.topic&&("("+data.topic.toLowerCase()+")").contains(checkfor))return!0}return!1}function removeDuplicates(data){for(var replies=[],i=0;i<data.length;i++)null==replies[data[i].txid]?replies[data[i].txid]=1:(data.splice(i,1),i--);return data}function mergeRepliesToRepliesBySameAuthor(data){for(var replies=[],authors=[],i=0;i<data.length;i++)replies[data[i].txid]=data[i].retxid,authors[data[i].txid]=data[i].address;for(i=0;i<data.length;i++)if(""!=data[i].retxid&&data[i].retxid!=data[i].roottxid&&data[i].address==authors[data[i].retxid])for(var j=0;j<data.length;j++)if(data[i].retxid==data[j].txid&&Math.abs(data[i].firstseen-data[j].firstseen)<21600){data[j].likes=(Number(data[j].likes)+Number(data[i].likes-1)).toString(),data[j].dislikes=(Number(data[j].dislikes)+Number(data[i].dislikes)).toString(),data[j].tips=(Number(data[j].tips)+Number(data[i].tips)).toString(),data[j].message=data[j].message+data[i].message;for(var k=0;k<data.length;k++)data[k].retxid==data[i].txid&&(data[k].retxid=data[j].txid);data.splice(i,1),i--;break}return data}function getAndPopulateCommunityRatings(qaddress){document.getElementById("communityratingtable").innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action=rated&qaddress="+qaddress+"&address="+pubkey).then(function(data){for(var contents="",i=0;i<data.length;i++)contents+=ratingAndReasonHTML(data[i]);document.getElementById("communityratingtable").innerHTML=contents;for(i=0;i<data.length;i++){var theRating=0;null!=data[i].rating&&(theRating=parseInt(data[i].rating)/64+1);var theAddress=san(data[i].address),starRating1=raterJs({starSize:24,rating:Math.round(10*theRating)/10,element:document.querySelector("#crating"+theAddress),disableText:rts(data[i].name)+" rates "+rts(data[i].rateename)+" as {rating}/{maxRating}"});starRating1.theAddress=theAddress,starRating1.disable()}},function(status){console.log("Something is wrong:"+status),document.getElementById("communityratingtable").innerHTML="Something is wrong:"+status,updateStatus(status)})}function getAndPopulateRatings(qaddress){document.getElementById("ratingtable").innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action=ratings&qaddress="+qaddress+"&address="+pubkey).then(function(data){for(var contents="",i=0;i<data.length;i++)contents+=ratingAndReason2HTML(data[i]);document.getElementById("ratingtable").innerHTML=contents;for(i=0;i<data.length;i++){var theRating=0;null!=data[i].rating&&(theRating=parseInt(data[i].rating)/64+1);var theAddress=san(data[i].rates),starRating1=raterJs({starSize:24,rating:Math.round(10*theRating)/10,element:document.querySelector("#rating"+theAddress),disableText:rts(data[i].ratername)+" rates "+rts(data[i].name)+" as {rating}/{maxRating}"});starRating1.theAddress=theAddress,starRating1.disable()}},function(status){console.log("Something is wrong:"+status),document.getElementById("ratingtable").innerHTML="Something is wrong:"+status,updateStatus(status)})}function getDataCommonToSettingsAndMember(qaddress,pre){getJSON(dropdowns.contentserver+"?action=settings&qaddress="+qaddress+"&address="+pubkey).then(function(data){if(data.length<1?(document.getElementById(pre+"followersnumber").innerHTML="0",document.getElementById(pre+"followingnumber").innerHTML="0",document.getElementById(pre+"blockersnumber").innerHTML="0",document.getElementById(pre+"blockingnumber").innerHTML="0",document.getElementById(pre+"nametext").value="",document.getElementById(pre+"profiletext").value="",document.getElementById(pre+"nametext").innerHTML="",document.getElementById(pre+"profiletext").innerHTML=""):(document.getElementById(pre+"followersnumber").innerHTML=Number(data[0].followers),document.getElementById(pre+"followingnumber").innerHTML=Number(data[0].following),document.getElementById(pre+"blockersnumber").innerHTML=Number(data[0].blockers),document.getElementById(pre+"blockingnumber").innerHTML=Number(data[0].blocking),document.getElementById(pre+"nametext").value=data[0].name,document.getElementById(pre+"profiletext").value=data[0].profile,document.getElementById(pre+"nametext").innerHTML=escapeHTML(data[0].name),document.getElementById(pre+"profiletext").innerHTML=escapeHTML(data[0].profile),document.getElementById(pre+"pagingid").innerHTML=escapeHTML("@"+data[0].pagingid),document.getElementById(pre+"profilelink").href="#member?qaddress="+san(qaddress),document.getElementById(pre+"profilelink").onclick=function(){showMember(qaddress)},document.getElementById(pre+"memoprofilelink").href="https://memo.cash/profile/"+san(qaddress)),"settings"==pre&&(document.getElementById(pre+"nametextbutton").disabled=!0,document.getElementById(pre+"profiletextbutton").disabled=!0,""==document.getElementById(pre+"nametext").value?document.getElementById(pre+"nametext").disabled=!1:document.getElementById(pre+"nametext").disabled=!0),document.getElementById(pre+"followersnumber").href="#followers?qaddress="+qaddress,document.getElementById(pre+"followersnumber").onclick=function(){showFollowers(qaddress)},document.getElementById(pre+"followingnumber").href="#following?qaddress="+qaddress,document.getElementById(pre+"followingnumber").onclick=function(){showFollowing(qaddress)},document.getElementById(pre+"blockersnumber").href="#blockers?qaddress="+qaddress,document.getElementById(pre+"blockersnumber").onclick=function(){showBlockers(qaddress)},document.getElementById(pre+"blockingnumber").href="#blocking?qaddress="+qaddress,document.getElementById(pre+"blockingnumber").onclick=function(){showBlocking(qaddress)},data.length<1||0==Number(data[0].isfollowing)?document.getElementById(pre+"follow").innerHTML=clickActionNamedHTML("follow",qaddress,"follow"):document.getElementById(pre+"follow").innerHTML=clickActionNamedHTML("unfollow",qaddress,"unfollow"),data.length<1||0==Number(data[0].isblocked)?document.getElementById(pre+"block").innerHTML=clickActionNamedHTML("mute",qaddress,"mute"):document.getElementById(pre+"block").innerHTML=clickActionNamedHTML("unmute",qaddress,"unmute"),"member"==pre&&qaddress==pubkey)document.getElementById(pre+"ratinggroup").style.display="none";else if("member"==pre){document.getElementById(pre+"ratinggroup").style.display="block",document.getElementById(pre+"ratingcomment").innerHTML=getRatingComment(qaddress,data),document.getElementById(pre+"ratingcommentinputbox"+qaddress).onchange=function(){starRating1.setRating(0)},document.getElementById("memberrating").innerHTML='<div data-ratingsize="20" data-ratingaddress="'+san(qaddress)+'" data-ratingraw="'+Number(data[0].rating)+'" id="memberrating'+qaddress+'"></div>';var starRating1=addSingleStarsRating(!1,document.getElementById("memberrating"+qaddress))}},function(status){console.log("Something is wrong:"+status),updateStatus(status)})}function getAndPopulateMember(qaddress){document.getElementById("memberlegacyformat").innerHTML=qaddress;var memberqpubkey=(new BITBOX.Address).toCashAddress(qaddress);document.getElementById("membercashaddrformat").innerHTML=memberqpubkey,getDataCommonToSettingsAndMember(qaddress,"member"),getAndPopulateCommunityRatings(qaddress),getAndPopulateRatings(qaddress),pubkey?getAndPopulateTrustGraph(pubkey,qaddress):document.getElementById("trustgraph").style.display="none"}function getAndPopulateSettings(){try{document.getElementById("legacyformat").innerHTML=pubkey}catch(err){}try{document.getElementById("cashaddrformat").innerHTML=qpubkey}catch(err){}try{document.getElementById("privatekeydisplay").innerHTML=(""==mnemonic?"":"Seed Phrase: "+mnemonic+"<br/>")+"Compressed Private Key: "+privkey}catch(err){}try{document.getElementById("privatekey").innerHTML=privatekeyClickToShowHTML()}catch(err){}var storedmutedwords=localStorageGet(localStorageSafe,"mutedwords");for(var key in void 0!=storedmutedwords&&null!=storedmutedwords&&(document.getElementById("mutedwords").value=storedmutedwords,mutedwords=storedmutedwords.split(",")),numbers){if("defaulttip"!=key)void 0!=(theSetting=localStorageGet(localStorageSafe,key))&&null!=theSetting?(document.getElementById(key).value=theSetting,numbers[key]=Number(theSetting)):document.getElementById(key).value=numbers[key]}for(var key in settings){void 0!=(theSetting=localStorageGet(localStorageSafe,key))&&null!=theSetting?(document.getElementById(key).checked=Boolean("true"==theSetting),settings[key]=theSetting):document.getElementById(key).checked=Boolean("true"==settings[key])}for(var key in dropdowns){var theSetting;null!=(theSetting=localStorageGet(localStorageSafe,key))&&(dropdowns[key]=theSetting);for(var selector=document.getElementById(key),opts=selector.options,i=0;i<opts.length;i++)opts[i].value==theSetting&&(selector.selectedIndex=i)}getDataCommonToSettingsAndMember(pubkey,"settings")}function updateSettingsCheckbox(settingsName){settings[settingsName]=""+document.getElementById(settingsName).checked,localStorageSet(localStorageSafe,settingsName,settings[settingsName])}function updateSettingsDropdown(settingsName){var selector=document.getElementById(settingsName);dropdowns[settingsName]=selector.options[selector.selectedIndex].value,localStorageSet(localStorageSafe,settingsName,dropdowns[settingsName])}function updateSettingsNumber(settingsName){numbers[settingsName]=Number(document.getElementById(settingsName).value),numbers[settingsName]<2&&(numbers[settingsName]=2),"results"==settingsName&&numbers[settingsName]>100&&(numbers[settingsName]=100),"maxfee"==settingsName&&numbers[settingsName]<2&&(numbers[settingsName]=2),"oneclicktip"==settingsName&&numbers[settingsName]<547&&(numbers[settingsName]=0),localStorageSet(localStorageSafe,settingsName,numbers[settingsName])}function showQRCode(spanid){var addressToQR=document.getElementById(spanid).innerHTML;document.getElementById(spanid+"div").innerHTML="",new QRCode(document.getElementById(spanid+"div"),addressToQR)}function rateCallbackAction(rating,that,ratingtext){void 0===ratingtext&&(ratingtext="");var qaddress=that.theAddress,transposed=0;switch(rating){case 1:transposed=1;break;case 2:transposed=64;break;case 3:transposed=128;break;case 4:transposed=192;break;case 5:transposed=255}rateUser(qaddress,transposed,ratingtext)&&that.setRating(rating)}function updatemutedwords(){var commasep=document.getElementById("mutedwords").value;mutedwords=commasep.split(",");for(var i=0;i<mutedwords.length;i++)mutedwords[i]=mutedwords[i].trim();localStorageSet(localStorageSafe,"mutedwords",mutedwords)}function getAndPopulateFollowers(qaddress){show("followers");var page="followers";getJSON(dropdowns.contentserver+"?action=followers&qaddress="+qaddress+"&address="+pubkey).then(function(data){for(var contents="",i=0;i<data.length;i++)contents+=getMembersWithRatingHTML(i,page,data[i],"Follows",!1);document.getElementById("follows").innerHTML=contents;var disable=!1;qaddress!=pubkey&&(disable=!0),addStarRatings(data,page,disable)},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function getAndPopulateFollowing(qaddress){show("following");var page="following";getJSON(dropdowns.contentserver+"?action=following&qaddress="+qaddress+"&address="+pubkey).then(function(data){for(var contents="",i=0;i<data.length;i++)contents+=getMembersWithRatingHTML(i,page,data[i],"Follows",!0);document.getElementById("followingtable").innerHTML=contents;var disable=!1;qaddress!=pubkey&&(disable=!0),addStarRatings(data,page,disable)},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function getAndPopulateBlockers(qaddress){show("blockers");var page="blockers";getJSON(dropdowns.contentserver+"?action=blockers&qaddress="+qaddress+"&address="+pubkey).then(function(data){for(var contents="",i=0;i<data.length;i++)contents+=getMembersWithRatingHTML(i,page,data[i],"Mutes",!1);document.getElementById("blocks").innerHTML=contents;var disable=!1;qaddress!=pubkey&&(disable=!0),addStarRatings(data,page,disable)},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function getAndPopulateBlocking(qaddress){show("blocking");var page="blocking";getJSON(dropdowns.contentserver+"?action=blocking&qaddress="+qaddress+"&address="+pubkey).then(function(data){for(var contents="",i=0;i<data.length;i++)contents+=getMembersWithRatingHTML(i,page,data[i],"Mutes",!0);document.getElementById("blockingtable").innerHTML=contents;var disable=!1;qaddress!=pubkey&&(disable=!0),addStarRatings(data,page,disable)},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function displayContentBasedOnURLParameters(){var url=window.location.href,action=sanitizeAlphanumeric(url.substring(url.indexOf("#")+1).toLowerCase());action.startsWith("show")?(setOrder("orderselector",getParameterByName("order")),setOrder("contentselector",getParameterByName("content")),setTopic(getParameterByName("topicname")),setOrder("filterselector",getParameterByName("filter")),showPostsNew(sanitizeAlphanumeric(getParameterByName("order")),sanitizeAlphanumeric(getParameterByName("content")),getParameterByName("topicname"),sanitizeAlphanumeric(getParameterByName("filter")),Number(getParameterByName("start")),Number(getParameterByName("limit")))):action.startsWith("memberposts")?showMemberPosts(Number(getParameterByName("start")),Number(getParameterByName("limit")),sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("notifications")?showNotifications(Number(getParameterByName("start")),Number(getParameterByName("limit")),sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("member")?showMember(sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("followers")?showFollowers(sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("following")?showFollowing(sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("blockers")?showBlockers(sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("blocking")?showBlocking(sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("ratings")?showRatings(sanitizeAlphanumeric(getParameterByName("qaddress"))):action.startsWith("bootstrap")?showBootstrap(sanitizeAlphanumeric(pubkey)):action.startsWith("posts")?showPosts(Number(getParameterByName("start")),Number(getParameterByName("limit")),sanitizeAlphanumeric(getParameterByName("type"))):action.startsWith("feed")?showFeed(Number(getParameterByName("start")),Number(getParameterByName("limit")),sanitizeAlphanumeric(getParameterByName("type"))):action.startsWith("comments")?showComments(Number(getParameterByName("start")),Number(getParameterByName("limit")),sanitizeAlphanumeric(getParameterByName("type"))):action.startsWith("trustgraph")?showTrustGraph(sanitizeAlphanumeric(getParameterByName("member")),sanitizeAlphanumeric(getParameterByName("target"))):action.startsWith("topiclist")?showTopicList():action.startsWith("topic")?showTopic(Number(getParameterByName("start")),Number(getParameterByName("limit")),getParameterByName("topicname"),sanitizeAlphanumeric(getParameterByName("type"))):action.startsWith("article")?showThread(sanitizeAlphanumeric(getParameterByName("root")),sanitizeAlphanumeric(getParameterByName("post")),!0):action.startsWith("thread")?showThread(sanitizeAlphanumeric(getParameterByName("root")),sanitizeAlphanumeric(getParameterByName("post")),!1):action.startsWith("settings")?showSettings():action.startsWith("new")?showNewPost():action.startsWith("map")?showMap(sanitizeAlphanumeric(getParameterByName("geohash")),sanitizeAlphanumeric(getParameterByName("post"))):action.startsWith("myfeed")?showMyFeed():action.startsWith("tools")?showTools():action.startsWith("login")&&(""==pubkey||null==pubkey||void 0==pubkey)?showLogin():showPosts(0,numbers.results,"all")}function hideAll(){setAddonStyle("none.css"),document.getElementById("feed").style.display="none",document.getElementById("posts").style.display="none",document.getElementById("comments").style.display="none",document.getElementById("thread").style.display="none",document.getElementById("memberposts").style.display="none",document.getElementById("notifications").style.display="none",document.getElementById("feed").innerHTML="",document.getElementById("posts").innerHTML="",document.getElementById("comments").innerHTML="",document.getElementById("thread").innerHTML="",document.getElementById("memberposts").innerHTML="",document.getElementById("notifications").innerHTML="",document.getElementById("settingsanchor").style.display="none",document.getElementById("loginbox").style.display="none",document.getElementById("followers").style.display="none",document.getElementById("following").style.display="none",document.getElementById("blockers").style.display="none",document.getElementById("blocking").style.display="none",document.getElementById("member").style.display="none",document.getElementById("newpost").style.display="none",document.getElementById("ratings").style.display="none",document.getElementById("map").style.display="none",document.getElementById("trustgraph").style.display="none",document.getElementById("bootstrap").style.display="none",document.getElementById("community").style.display="none",document.getElementById("topiclistanchor").style.display="none",document.getElementById("toolsanchor").style.display="none"}function show(theDiv){hideAll(),document.getElementById(theDiv).style.display="block"}function showTools(){show("toolsanchor")}function showLogin(){show("loginbox")}function showMap(geohash,posttrxid){show("map"),getAndPopulateMap(geohash,posttrxid),document.getElementById("map").style.display="block"}function hideMap(){document.getElementById("map").style.display="none"}function showRatings(qaddress){show("ratings"),getAndPopulateRatings(qaddress),document.getElementById("ratings").style.display="block"}function showBootstrap(qaddress){show("bootstrap"),getAndPopulateBootstrap(qaddress)}function showNewPost(){show("newpost"),document.getElementById("memorandumpreview").innerHTML="";let topicNameHOSTILE=getCurrentTopicHOSTILE();document.getElementById("memotopic").value=topicNameHOSTILE,document.getElementById("memorandumtopic").value=topicNameHOSTILE,""!=topicNameHOSTILE?(document.getElementById("memorandumtopicarea").style.display="block",document.getElementById("memotopicarea").style.display="block"):(document.getElementById("memorandumtopicarea").style.display="none",document.getElementById("memotopicarea").style.display="none"),topictitleChanged("memorandum"),topictitleChanged("memo"),document.getElementById("newpostbutton").style.display="block",initMarkdownEditor()}function showNotifications(start,limit){""!=pubkey&&null!=pubkey&&void 0!=pubkey?getAndPopulateNotifications(start,limit,"notifications",pubkey):showPosts(0,numbers.results,"all")}function showSettings(){""!=pubkey&&null!=pubkey&&void 0!=pubkey?(getAndPopulateSettings(),getAndPopulate(0,numbers.results,"memberposts",pubkey),document.getElementById("settingsanchor").style.display="block",document.getElementById("settingsfollow").style.display="block"):showPosts(0,numbers.results,"all")}function showMember(qaddress){getAndPopulateMember(qaddress),getAndPopulate(0,numbers.results,"memberposts",qaddress),document.getElementById("member").style.display="block",document.getElementById("memberfollow").style.display="block",document.getElementById("memberblock").style.display="block",document.getElementById("community").style.display="block",document.getElementById("ratings").style.display="block",document.getElementById("trustgraph").style.display="block"}function showTrustGraph(member,target){show("trustgraph"),getAndPopulateTrustGraph(member,target)}function showMemberPosts(start,limit,qaddress){getAndPopulate(start,limit,"memberposts",qaddress)}function showFeed(start,limit,type){showPFC(start,limit,"posts",pubkey,type)}function showPosts(start,limit,type){showPFC(start,limit,"posts",pubkey,type)}function showComments(start,limit,type){showPFC(start,limit,"replies",pubkey,type)}function showPFC(start,limit,page,pubkey,type){showPostsNew("hot",page,getCurrentTopicHOSTILE(),"everyone",start,limit)}function showMyFeed(){getAndPopulateNew("new","posts","myfeed","myfeed",0,numbers.results,"posts",pubkey)}function showPostsNew(order,content,topicnameHOSTILE,filter,start,limit){getAndPopulateNew(order,content,topicnameHOSTILE,filter,start,limit,"posts",pubkey)}function showTopic(start,limit,topicnameHOSTILE,type){setTopic(topicnameHOSTILE),""==type&&(type="new"),getAndPopulateNew(type,"posts",topicnameHOSTILE,"everyone",start,limit,"posts",pubkey)}function getCurrentTopicHOSTILE(){var selector=document.getElementById("topicselector");return selector.options[selector.selectedIndex].value}function showTopicList(){getAndPopulateTopicList(!0)}function postsSelectorChanged(){var selector,order=(selector=document.getElementById("orderselector")).options[selector.selectedIndex].value,content=(selector=document.getElementById("contentselector")).options[selector.selectedIndex].value,topicNameHOSTILE=(selector=document.getElementById("topicselector")).options[selector.selectedIndex].value,filter=(selector=document.getElementById("filterselector")).options[selector.selectedIndex].value;document.location.href="#show?order="+order+"&content="+content+"&topicname="+encodeURIComponent(topicNameHOSTILE)+"&filter="+filter+"&start=0&limit="+Number(numbers.results),displayContentBasedOnURLParameters()}function setOrder(selectorvalue,order){for(var selector=document.getElementById(selectorvalue),i=0;i<selector.length;i++)selector.options[i].value==order&&(selector.selectedIndex=i)}function setTopic(topicNameHOSTILE){var selector=document.getElementById("topicselector");null!=topicNameHOSTILE&&""!=topicNameHOSTILE?(selector.selectedIndex=1,selector.options[selector.selectedIndex].value=topicNameHOSTILE,selector.options[selector.selectedIndex].text=capitalizeFirstLetter(topicNameHOSTILE.substring(0,13))):selector.selectedIndex=0}function showThread(roottxid,txid,articleStyle){getAndPopulateThread(roottxid,txid,"thread"),articleStyle&&setAddonStyle("article.css")}function showFollowers(qaddress){getAndPopulateFollowers(qaddress)}function showFollowing(qaddress){getAndPopulateFollowing(qaddress)}function showBlockers(qaddress){getAndPopulateBlockers(qaddress)}function showBlocking(qaddress){getAndPopulateBlocking(qaddress)}DOMPurify.addHook("afterSanitizeAttributes",function(node){"target"in node&&(node.setAttribute("target","_blank"),node.setAttribute("rel","noopener noreferrer")),node.hasAttribute("target")||!node.hasAttribute("xlink:href")&&!node.hasAttribute("href")||node.setAttribute("xlink:show","new")}),window.onmessage=(oe=>{"https://twitframe.com"==oe.origin&&oe.data.height&&oe.data.element.match(/^tweet_/)&&(document.getElementById(oe.data.element).style.height=parseInt(oe.data.height)+"px")});var suspendPageReload=!1,detectBackOrForward=function(onBack,onForward){let hashHistory=[window.location.hash],historyLength=window.history.length;return function(){var hash=window.location.hash,length=window.history.length;hashHistory.length&&historyLength==length?hashHistory[hashHistory.length-2]==hash?(hashHistory=hashHistory.slice(0,-1),suspendPageReload||onBack()):(hashHistory.push(hash),suspendPageReload||onForward()):(hashHistory.push(hash),historyLength=length)}};function checkForPrivKey(){return""!=privkey||(alert("You must login to do this."),!1)}function sendTransaction(tx){tq.queueTransaction(tx)}function setName(){if(!checkForPrivKey())return!1;document.getElementById("settingsnametextbutton").disabled=!0,document.getElementById("settingsnametext").disabled=!0;const tx={data:["0x6d01",document.getElementById("settingsnametext").value],cash:{key:privkey}};updateStatus("Setting Name"),tq.queueTransaction(tx)}function postmemorandumRaw(posttext,postbody,privkey,topic,newpostmemorandumstatus,memorandumpostcompleted){var tx={data:["0x6d02",posttext],cash:{key:privkey}};""!=topic&&(tx={data:["0x6d0c",topic,posttext],cash:{key:privkey}});const replyHex=new Buffer(postbody).toString("hex");tq.queueTransaction(tx,function(newtxid){sendReplyRaw(privkey,newtxid,replyHex,5e3,newpostmemorandumstatus,memorandumpostcompleted)},null)}function postRaw(posttext,privkey,topic,newpoststatus,memocompleted){var tx={data:["0x6d02",posttext],cash:{key:privkey}};""!=topic&&(tx={data:["0x6d0c",topic,posttext],cash:{key:privkey}}),tq.queueTransaction(tx,memocompleted,null)}function postgeoRaw(posttext,privkey,geohash,newpostgeostatus,geocompleted){const tx={data:["0x6da8",geohash,posttext],cash:{key:privkey}};updateStatus("Sending Geotagged Post"),tq.queueTransaction(tx,geocompleted,null)}async function sendReplyRaw(privatekey,txid,replyHex,waitTimeMilliseconds,divForStatus,completionFunction){document.getElementById(divForStatus).value="Sending Reply . . . "+replyHex.length/2+" bytes remaining.";var sendHex="";if(replyHex.length>368){var whitespaceIndex=348,spaceIndex=replyHex.lastIndexOf("20",368);spaceIndex%2==0&&spaceIndex>whitespaceIndex&&(whitespaceIndex=spaceIndex);var nlIndex=replyHex.lastIndexOf("0A",368);nlIndex%2==0&&nlIndex>whitespaceIndex&&(whitespaceIndex=nlIndex);var crIndex=replyHex.lastIndexOf("0D",368);crIndex%2==0&&crIndex>whitespaceIndex&&(whitespaceIndex=crIndex),whitespaceIndex>348?(sendHex=replyHex.substring(0,whitespaceIndex),replyHex=replyHex.substring(whitespaceIndex)):(sendHex=replyHex.substring(0,368),replyHex=replyHex.substring(368))}else sendHex=replyHex,replyHex="";const tx={data:["0x6d03","0x"+txid.match(/[a-fA-F0-9]{2}/g).reverse().join(""),"0x"+sendHex],cash:{key:privatekey}};waitTimeMilliseconds>0&&(updateStatus("Waiting "+waitTimeMilliseconds/1e3+" Seconds"),await sleep(waitTimeMilliseconds)),replyHex.length>0?tq.queueTransaction(tx,function(newtxid){sendReplyRaw(privatekey,newtxid,replyHex,1e3,divForStatus,completionFunction)},null):tq.queueTransaction(tx,completionFunction,null)}function sendTipRaw(txid,tipAddress,tipAmount,privkey,successFunction){const tx={data:["0x6d04","0x"+txid.match(/[a-fA-F0-9]{2}/g).reverse().join("")],cash:{key:privkey,to:[{address:tipAddress,value:Number(tipAmount)}]}};updateStatus("Sending Tip"),tq.queueTransaction(tx,successFunction,null)}function sendLike(txid){if(!checkForPrivKey())return!1;const tx={data:["0x6d04","0x"+txid.match(/[a-fA-F0-9]{2}/g).reverse().join("")],cash:{key:privkey}};updateStatus("Sending Like"),tq.queueTransaction(tx)}function setProfile(){if(!checkForPrivKey())return!1;document.getElementById("settingsprofiletextbutton").disabled=!0;const tx={data:["0x6d05",document.getElementById("settingsprofiletext").value],cash:{key:privkey}};updateStatus("Setting Profile"),tq.queueTransaction(tx)}function sub(topicHOSTILE){if(!checkForPrivKey())return!1;event.srcElement.style.display="none";const tx={data:["0x6d0d",topicHOSTILE],cash:{key:privkey}};updateStatus("Sending Subscribe"),tq.queueTransaction(tx)}function unsub(topicHOSTILE){if(!checkForPrivKey())return!1;event.srcElement.style.display="none";const tx={data:["0x6d0e",topicHOSTILE],cash:{key:privkey}};updateStatus("Sending Unsubscribe"),tq.queueTransaction(tx)}function addressTransaction(removeElementID,qaddress,actionCode,statusMessage){if(!checkForPrivKey())return!1;document.getElementById(removeElementID).style.display="none";const tx={data:[actionCode,"0x"+(new BITBOX.Address).legacyToHash160(qaddress)],cash:{key:privkey}};updateStatus(statusMessage),tq.queueTransaction(tx)}function follow(qaddress){addressTransaction("memberfollow",qaddress,"0x6d06","Sending Follow")}function unfollow(qaddress){addressTransaction("memberfollow",qaddress,"0x6d07","Sending Unfollow")}function mute(qaddress){addressTransaction("memberblock",qaddress,"0x6d16","Sending Mute")}function unmute(qaddress){addressTransaction("memberblock",qaddress,"0x6d17","Sending Unmute")}function sendDislike(txid){txidTransaction(txid,"0x6db4","Sending Dislike")}function sendHidePost(txid){txidTransaction(txid,"0x6dc5","Sending Hide Post")}function sendSendUnhidePost(txid){txidTransaction(txid,"0x6dc6","Sending Unhide Post")}function txidTransaction(txid,actionCode,statusMessage){if(!checkForPrivKey())return!1;const tx={data:[actionCode,"0x"+txid.match(/[a-fA-F0-9]{2}/g).reverse().join("")],cash:{key:privkey}};updateStatus(statusMessage),tq.queueTransaction(tx)}function rateUser(qaddress,rating,ratingcomment){if(!checkForPrivKey())return!1;void 0===ratingcomment&&(ratingcomment="");const tx={data:["0x6da5","0x"+(new BITBOX.Address).legacyToHash160(qaddress),"0x"+toHexString([rating]),ratingcomment],cash:{key:privkey}};return updateStatus("Sending Rating"),tq.queueTransaction(tx),!0}function designate(qaddress,topicHOSTILE,elementid){addressTopicTransaction(elementid,qaddress,"0x6dc1","Sending Designate Moderator",topicHOSTILE)}function dismiss(qaddress,topicHOSTILE,elementid){addressTopicTransaction(elementid,qaddress,"0x6dc2","Sending Dismiss Moderator",topicHOSTILE)}function hideuser(qaddress,topicHOSTILE,elementid){addressTopicTransaction(elementid,qaddress,"0x6dc3","Sending Hide Member",topicHOSTILE)}function unhideuser(qaddress,topicHOSTILE,elementid){addressTopicTransaction(elementid,qaddress,"0x6dc4","Sending Unhide Member",topicHOSTILE)}function addressTopicTransaction(removeElementID,qaddress,actionCode,statusMessage,topicHOSTILE){if(!checkForPrivKey())return!1;document.getElementById(removeElementID).style.display="none";const tx={data:[actionCode,"0x"+(new BITBOX.Address).legacyToHash160(qaddress),topicHOSTILE],cash:{key:privkey}};updateStatus(statusMessage),tq.queueTransaction(tx)}window.addEventListener("hashchange",detectBackOrForward(function(){displayContentBasedOnURLParameters()},function(){displayContentBasedOnURLParameters()}));const DUSTLIMIT=546,MAXPOSSNUMBEROFINPUTS=10,Buffer=buffer.Buffer,BITBOX=bitboxSdk;let extraSatoshis=5,miningFeeMultiplier=1;class UTXOPool{constructor(address,statusMessageFunction,storageObject){this.theAddress=address,this.utxoPool={},this.statusMessageFunction=statusMessageFunction,this.storageObject=storageObject;try{if(null!=this.storageObject){let loadup=JSON.parse(localStorageGet(this.storageObject,"utxopool"));"null"!=loadup&&null!=loadup&&""!=loadup&&(this.utxoPool=loadup,this.updateBalance())}}catch(err){this.statusMessageFunction(err)}}updateStatus(message){console.log(message),null==this.statusMessageFunction?alert(message):this.statusMessageFunction(message)}getUTXOs(){return Array.from(this.utxoPool)}removeUTXO(txid,vout){for(let i=0;i<this.utxoPool.length;i++)if(this.utxoPool[i].txid==txid&&this.utxoPool[i].vout==vout)return this.utxoPool.splice(i,1),!0;return!1}addUTXO(txid,vout,satoshis){for(let i=0;i<this.utxoPool.length;i++)if(this.utxoPool[i].txid==txid&&this.utxoPool[i].vout==vout)return!1;return this.utxoPool.push({satoshis:satoshis,vout:vout,txid:txid}),!0}updateBalance(){try{void 0!=this.storageObject&&null!=this.storageObject&&localStorageSet(this.storageObject,"utxopool",JSON.stringify(this.utxoPool))}catch(err){}var total=0;for(let i=0;i<this.utxoPool.length;i++)total+=this.utxoPool[i].satoshis;document.getElementById("balance").innerHTML=balanceString(total,!0)}refreshPool(){let outputInfo=new Array,thePublicKeyQFormat=(new BITBOX.Address).toCashAddress(this.theAddress);let address=new(0,BITBOX.Address);address.restURL=dropdowns.utxoserver,(async()=>{let utxos=(outputInfo=await address.utxo(thePublicKeyQFormat)).utxos,utxosOriginalNumber=outputInfo.utxos.length;for(let i=0;i<utxos.length;i++)utxos[i].satoshis=Number(utxos[i].satoshis),utxos[i].vout=Number(utxos[i].vout),utxos[i].txid=sanitizeAlphanumeric(utxos[i].txid);for(let i=0;i<utxos.length;i++)utxos[i].satoshis<=DUSTLIMIT&&(utxos.splice(i,1),i--);let usableUTXOScount=utxos.length;this.updateStatus("Received "+utxosOriginalNumber+" utxo(s) of which "+usableUTXOScount+" are usable."),this.utxoPool=utxos,this.updateBalance()})()}}class TransactionQueue{_script(opcode,options){var s=[];return options.data&&(Array.isArray(options.data)?(s.push(opcode),options.data.forEach(function(item){/^0x/i.test(item)?s.push(Buffer.from(item.slice(2),"hex")):s.push(Buffer.from(item))})):"string"==typeof options.data&&(s=[options.data])),s}constructor(statusMessageFunction){this.queue=new Array,this.spentUTXO={},this.onSuccessFunctionQueue=new Array,this.isSending=!1,this.statusMessageFunction=statusMessageFunction,this.transactionInProgress=!1,this.utxopools={}}addUTXOPool(address,storageObject){this.utxopools[address]=new UTXOPool(address,this.statusMessageFunction,storageObject);try{this.utxopools[address].refreshPool()}catch(err){this.statusMessageFunction(err)}}isTransactionInProgress(){return!!(this.transactionInProgress||this.queue.length>0)}queueTransaction(transaction,onSuccessFunction){this.queue.push(transaction),this.onSuccessFunctionQueue.push(onSuccessFunction),this.sendNextTransaction()}sendNextTransaction(){0!=this.queue.length?this.isSending||(this.isSending=!0,this.memberBoxSend(this.queue[0],this.serverResponseFunction)):this.isSending=!1}updateStatus(message){console.log(message),null==this.statusMessageFunction?alert(message):this.statusMessageFunction(message)}async serverResponseFunction(err,res,returnObject){if(returnObject.isSending=!1,err){console.log(err);let errorMessage=err.message;return returnObject.updateStatus("Error:"+errorMessage),void 0===errorMessage&&(errorMessage="Network Error"),errorMessage.startsWith("64")?(returnObject.updateStatus(errorMessage+" ("+returnObject.queue.length+" .Transaction(s) Still Queued. Waiting for new block, Retry in 60 seconds)"),await sleep(6e4),returnObject.updateStatus("Sending Again . . ."),await sleep(1e3),void returnObject.sendNextTransaction()):errorMessage.startsWith("1001")?(returnObject.updateStatus(errorMessage+" ("+returnObject.queue.length+" .Transaction(s) Still Queued. Retry in 60 seconds)"),await sleep(6e4),returnObject.updateStatus("Sending Again . . ."),await sleep(1e3),void returnObject.sendNextTransaction()):errorMessage.startsWith("Network Error")||errorMessage.startsWith("258")||errorMessage.startsWith("200")?(returnObject.updateStatus(errorMessage+" ("+returnObject.queue.length+" Transaction(s) Still Queued, Retry in 5 seconds)"),await sleep(4e3),returnObject.updateStatus("Sending Again . . ."),await sleep(1e3),void returnObject.sendNextTransaction()):errorMessage.startsWith("1000")?(returnObject.updateStatus(errorMessage+" Removing Transaction From Queue."),returnObject.onSuccessFunctionQueue.shift(),returnObject.queue.shift(),void returnObject.sendNextTransaction()):errorMessage.startsWith("66")&&miningFeeMultiplier<maxfee?(miningFeeMultiplier*=1.1,returnObject.updateStatus("Error: Transaction rejected because fee too low. Increasing and retrying. Surge Pricing now "+Math.round(10*miningFeeMultiplier)/10),await sleep(1e3),void returnObject.sendNextTransaction()):void alert("There was an error processing the transaction required for this action. Make sure you have sufficient funds in your account and try again. Error:"+errorMessage)}if(res.length>10){returnObject.updateStatus("<a  rel='noopener noreferrer' target='blockchair' href='https://blockchair.com/bitcoin-cash/transaction/"+res+"'>txid:"+res+"</a>");let successCallback=returnObject.onSuccessFunctionQueue.shift();returnObject.queue.shift(),successCallback&&successCallback(res),await sleep(1e3),returnObject.sendNextTransaction()}else returnObject.updateStatus(res)}async memberBoxSend(options,callback,returnObject){if(options.cash&&options.cash.key)try{this.transactionInProgress=!0;let utxos=this.selectUTXOs(options),tx=this.constructTransaction(utxos,0,options),transactionSize=tx.byteLength(),fees=Math.round(transactionSize*miningFeeMultiplier)+extraSatoshis;tx=this.constructTransaction(utxos,fees,options),this.broadcastTransaction(tx,utxos,options,callback)}catch(err){return this.transactionInProgress=!1,void callback(err,null,this)}else callback(new Error("1000:No Private Key, Cannot Make Transaction"),null,this)}selectUTXOs(options){let theAddress=(new(0,BITBOX.ECPair)).fromWIF(options.cash.key).getAddress();null==this.utxopools[theAddress]&&this.addUTXOPool(theAddress);let utxos=this.utxopools[theAddress].getUTXOs();if(0==utxos.length)throw new Error("1001:Insufficient Funds (No Suitable UTXOs)");let usableUTXOScount=utxos.length;var ballparkAmountRequired=450*miningFeeMultiplier+546;options.cash.to&&Array.isArray(options.cash.to)&&options.cash.to.forEach(function(receiver){receiver.value>=DUSTLIMIT&&(ballparkAmountRequired+=receiver.value)});let totalUseUtxos=0,useUtxos=new Array;for(;totalUseUtxos<ballparkAmountRequired&&utxos.length>0;){let randomUTXOindex=Math.floor(Math.random()*utxos.length);1==!this.spentUTXO[utxos[randomUTXOindex].txid+utxos[randomUTXOindex].vout]&&(totalUseUtxos+=utxos[randomUTXOindex].satoshis,useUtxos.push(utxos[randomUTXOindex])),utxos.splice(randomUTXOindex,1)}if(utxos=useUtxos,this.updateStatus("Pool has "+usableUTXOScount+" utxo(s). Using "+utxos.length),0==utxos.length)throw new Error("2000:All UTXOs are already spent");return utxos}constructTransaction(utxos,fees,options){const TransactionBuilder=BITBOX.TransactionBuilder,Script=BITBOX.Script;let keyPair=(new(0,BITBOX.ECPair)).fromWIF(options.cash.key),changeAddress=keyPair.getAddress(),script=new Script,scriptArray=this._script(script.opcodes.OP_RETURN,options),script2=script.encode(scriptArray),changeAmount=0,transactionBuilder=new TransactionBuilder;scriptArray.length>0&&transactionBuilder.addOutput(script2,0);let fundsRemaining=0;for(let i=0;i<utxos.length;i++){let originalAmount=utxos[i].satoshis;fundsRemaining+=originalAmount;let vout=utxos[i].vout,txid=utxos[i].txid;transactionBuilder.addInput(txid,vout)}let utxoFunds=fundsRemaining,transactionOutputTotal=0;if(options.cash.to&&Array.isArray(options.cash.to)&&options.cash.to.forEach(function(receiver){receiver.value>=DUSTLIMIT&&(fundsRemaining-=receiver.value,transactionOutputTotal+=receiver.value,transactionBuilder.addOutput(receiver.address,receiver.value))}),(changeAmount=fundsRemaining-fees)<0)throw new Error("2001: Insufficient Funds. Amount available "+utxoFunds+" in "+utxos.length+" UTXOs but "+(transactionOutputTotal+fees)+" required. Add Funds.");changeAmount>=DUSTLIMIT&&transactionBuilder.addOutput(changeAddress,changeAmount);for(let i=0;i<utxos.length;i++){let redeemScript,originalAmount=utxos[i].satoshis;transactionBuilder.sign(i,keyPair,redeemScript,transactionBuilder.hashTypes.SIGHASH_ALL,originalAmount)}let tx=transactionBuilder.build();return tx.outs[tx.outs.length-1].isChange=!0,tx}broadcastTransaction(tx,utxos,options,callback){let hex=tx.toHex();tx.getHash().toString("hex"),tx.getId();let rawtransactions=new(0,BITBOX.RawTransactions);rawtransactions.restURL=dropdowns.txbroadcastserver,rawtransactions.sendRawTransaction(hex).then(result=>{this.updateTransactionPool(utxos,options,tx),this.transactionInProgress=!1,result=sanitizeAlphanumeric(result),callback(null,result,this)},err=>{this.transactionInProgress=!1,err.message=sanitizeAlphanumeric(err.error),void 0!==err.message&&""!=err.message||(err.message="Network Error"),callback(err,null,this)})}updateTransactionPool(utxos,options,tx){let changeAddress=(new(0,BITBOX.ECPair)).fromWIF(options.cash.key).getAddress(),theUTXOPool=this.utxopools[changeAddress];for(let i=0;i<utxos.length;i++)this.spentUTXO[utxos[i].txid+utxos[i].vout]=1,theUTXOPool.removeUTXO(utxos[i].txid,utxos[i].vout);for(let i=0;i<tx.outs.length;i++)1==tx.outs[i].isChange&&theUTXOPool.addUTXO(tx.getId(),i,tx.outs[i].value);theUTXOPool.updateBalance()}}var popup,postpopup,map=null,markersDict={},firstload=!0,mapTileProvider="https://tile.openstreetmap.org/{z}/{x}/{y}.png";function getAndPopulateMap(geohash,posttrxid){if(geohash=san(geohash),posttrxid=san(posttrxid),null==map){map=L.map("map",{attributionControl:!1});var att=L.control.attribution();att.setPrefix(""),att.addAttribution(getMapCloseButtonHTML()).setPosition("topright").addTo(map),map.on("moveend",loadLocationListFromServerAndPlaceOnMap),map.setView([51.505,-.09],13),L.tileLayer(mapTileProvider,{}).addTo(map),L.control.attribution().addAttribution(getOSMattributionHTML()).setPosition("bottomright").addTo(map),popup=L.popup({autoPan:!0}),postpopup=L.popup({autoPan:!0,minWidth:300})}if(null==geohash||""==geohash)setTimeout(function(){navigator.geolocation.getCurrentPosition(function(location){map.setView([location.coords.latitude,location.coords.longitude],13)})},1e3);else{var zoomLocation=decodeGeoHash(geohash);zoomLocation=[zoomLocation.latitude[0],zoomLocation.longitude[0]],setTimeout(function(){null!=posttrxid&&""!=posttrxid&&(popup.txid=posttrxid),map.setView(zoomLocation,15),null!=posttrxid&&""!=posttrxid&&(popup.setLatLng(zoomLocation).setContent(mapThreadLoadingHTML("")).openOn(map),getAndPopulateThread(posttrxid,posttrxid,"mapthread"))},1e3)}map.on("click",onMapClick),map.on("moveend",function(){suspendPageReload=!0,firstload&&null!=popup.txid?(location.href="#map?geohash="+encodeGeoHash(map.getCenter().lat,map.getCenter().lng)+"&post="+popup.txid,firstload=!1):popup.isOpen()&&null!=popup.txid?location.href="#map?geohash="+encodeGeoHash(popup._latlng.lat,popup._latlng.lng)+"&post="+popup.txid:location.href="#map?geohash="+encodeGeoHash(map.getCenter().lat,map.getCenter().lng),setTimeout(function(){suspendPageReload=!1},1e3)}),popup.on("close",function(e){console.log("map popup closed"),popup.txid=null,map.moveend()})}function openOverlay(e){var marker=e.sourceTarget;popup.setLatLng(e.latlng).setContent(mapThreadLoadingHTML(marker.previewHTML)).openOn(map),getAndPopulateThread(marker.roottxid,marker.txid,"mapthread"),popup.txid=marker.roottxid,popup.txidloc=e.latlng,suspendPageReload=!0,location.href="#map?geohash="+encodeGeoHash(e.latlng.lat,e.latlng.lng)+"&post="+popup.txid,setTimeout(function(){suspendPageReload=!1},1e3)}function openPreview(e){var marker=e.sourceTarget;marker.bindTooltip(marker.previewHTML).openTooltip()}function onMapClick(e){var htmlContent=getMapPostHTML(e.latlng.lat,e.latlng.lng,""==pubkey);postpopup.setLatLng(e.latlng).setContent(htmlContent).openOn(map)}function loadLocationListFromServerAndPlaceOnMap(event){var mapBounds=map.getBounds(),url=dropdowns.contentserver+"?action=map&address="+pubkey+"&north="+mapBounds.getNorthEast().lat+"&east="+mapBounds.getNorthEast().lng+"&south="+mapBounds.getSouthWest().lat+"&west="+mapBounds.getSouthWest().lng;getJSON(url).then(function(data){for(var i=0;i<data.length;i++){var marker,pageName=san(data[i].txid);if(null==(marker=markersDict[pageName]))(marker=L.marker([Number(data[i].lat),Number(data[i].lon)]).addTo(map)).txid=san(data[i].txid),marker.roottxid=san(data[i].roottxid),marker.previewHTML=ds(data[i].message),markersDict[pageName]=marker,marker.on("click",openOverlay),marker.on("mouseover",openPreview)}},function(status){console.log("Something is wrong:"+status),updateStatus(status)})}function getAndPopulateTrustGraph(member,target){document.getElementById("trustgraphdetails").innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action=trustgraph&address="+member+"&qaddress="+target).then(function(data){for(var directrating=0,oneRemoveRating=0,oneRemoveRatingCount=0,overallRating=0,contentsHTML="",i=0;i<data.length;i++)0==i&&""==data[i].inter?(contentsHTML+=getDirectRatingHTML(data[i]),directrating=Number(data[i].memberrating)):(contentsHTML+=getIndirectRatingHTML(data[i]),(i<6||Number(data[i].memberrating)>191)&&(oneRemoveRating+=Math.min(Number(data[i].memberrating),Number(data[i].interrating)),oneRemoveRatingCount++));var oneRemove=0;oneRemoveRatingCount>0&&(oneRemove=oneRemoveRating/oneRemoveRatingCount),directrating>0&&oneRemoveRatingCount>0?overallRating=(directrating+oneRemove)/2:directrating>0&&0==oneRemoveRatingCount?overallRating=directrating:0==directrating&&oneRemoveRatingCount>0&&(overallRating=oneRemove),contentsHTML=getTrustRatingTableHTML(contentsHTML,(overallRating=overallRating/64+1).toFixed(1)),document.getElementById("trustgraphdetails").innerHTML=contentsHTML,raterJs({starSize:48,rating:Math.round(10*overallRating)/10,element:document.querySelector("#overall")}).disable();for(i=0;i<data.length;i++)if(0==i&&""==data[i].inter){var textNote="";191==(rawRating=Number(data[i].memberrating))?textNote=" (Follows)":63==rawRating&&(textNote=" (Blocks)");var theRating=rawRating/64+1;raterJs({starSize:24,rating:Math.round(10*theRating)/10,element:document.querySelector("#trust"+san(data[i].member)+san(data[i].target)),disableText:rts(data[i].membername)+" rates "+rts(data[i].targetname)+" as {rating}/{maxRating}"+textNote}).disable()}else{theRating=Number(data[i].memberrating)/64+1,textNote="";191==(rawRating=Number(data[i].memberrating))?textNote=" (Follows)":63==rawRating&&(textNote=" (Blocks)"),raterJs({starSize:18,rating:Math.round(10*theRating)/10,element:document.querySelector("#trust"+san(data[i].member)+san(data[i].inter)),disableText:rts(data[i].membername)+" rates "+rts(data[i].intername)+" as {rating}/{maxRating}"+textNote}).disable();var rawRating,theRating2=Number(data[i].interrating)/64+1,textNote2="";191==(rawRating=Number(data[i].interrating))?textNote2=" (Follows)":63==rawRating&&(textNote2=" (Blocks)"),raterJs({starSize:18,rating:Math.round(10*theRating2)/10,element:document.querySelector("#trust"+san(data[i].inter)+san(data[i].target)),disableText:rts(data[i].intername)+" rates "+rts(data[i].targetname)+" as {rating}/{maxRating}"+textNote2}).disable()}},function(status){console.log("Something is wrong:"+status),document.getElementById("trustgraphdetails").innerHTML="Something is wrong:"+status,updateStatus(status)})}function somethingwentwrong(status){console.log("Something is wrong:"+status),updateStatus(status)}async function getAndPopulateBootstrap(qaddress){bootstrapnames={},bstcount=0,document.getElementById("bootstraptable1").innerHTML=document.getElementById("loading").innerHTML,document.getElementById("bootstraptable2").innerHTML=document.getElementById("loading").innerHTML,document.getElementById("bootstraptable3").innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action=bootstrap1&qaddress="+qaddress+"&address="+pubkey).then(processdataintoratings,somethingwentwrong),await sleep(2e3),getJSON(dropdowns.contentserver+"?action=bootstrap2&qaddress="+qaddress+"&address="+pubkey).then(processdataintoratings,somethingwentwrong),await sleep(2e3),getJSON(dropdowns.contentserver+"?action=bootstrap3&qaddress="+qaddress+"&address="+pubkey).then(processdataintoratings,somethingwentwrong)}var bstcount=0,bootstrapnames={};function processdataintoratings(data){for(var lbstcount=++bstcount,contents="",i=0;i<data.length;i++)bootstrapnames[data[i].testaddress]>0||(bootstrapnames[data[i].testaddress]=1,contents+=getBootStrapHTML(pubkey,data[i],lbstcount));document.getElementById("bootstraptable"+lbstcount).innerHTML=contents;for(i=0;i<data.length;i++)if(!(bootstrapnames[data[i].testaddress]>1)&&(bootstrapnames[data[i].testaddress]=2,void 0!==document.getElementById("#rating"+lbstcount+theAddress))){var theRating=0;null!=data[i].rating&&(theRating=parseInt(data[i].rating)/64+1);var theAddress=ds(data[i].testaddress);raterJs({starSize:24,rating:Math.round(10*theRating)/10,element:document.querySelector("#rating"+lbstcount+theAddress),disableText:ds(data[i].ratername)+" rates "+ds(data[i].name)+" as {rating}/{maxRating}",rateCallback:function(rating,done){rateCallbackAction(rating,this),done()}}).theAddress=theAddress}}var version="3.5.6",pubkey="",mnemonic="",privkey="",qpubkey="",mutedwords=new Array;let tq=new TransactionQueue(updateStatus);var defaulttip=1e3,oneclicktip=0,maxfee=5;mapTileProvider="https://tile.openstreetmap.org/{z}/{x}/{y}.png";var settings={showyoutube:"true",showimgur:"true",showtwitter:"true"},dropdowns={contentserver:"https://memberjs.org:8123/member.js",txbroadcastserver:"https://memberjs.org:8123/v2/",utxoserver:"https://rest.bitcoin.com/v2/",currencydisplay:"USD"},numbers={defaulttip:1e3,oneclicktip:0,maxfee:2,results:25},localStorageSafe=null;try{localStorageSafe=localStorage}catch(err){}var ShowdownConverter=new showdown.Converter;function init(){document.getElementById("version").innerHTML=version,getLatestUSDrate(),setLang(navigator.language||navigator.userLanguage),"memberapp.github.io"!=document.location.host&&(document.getElementById("developmentversion").style.display="block");var loginmnemonic=localStorageGet(localStorageSafe,"mnemonic"),loginprivkey=localStorageGet(localStorageSafe,"privkey"),loginpubkey=localStorageGet(localStorageSafe,"pubkey");"null"==loginmnemonic||null==loginmnemonic||""==loginmnemonic?"null"==loginprivkey||null==loginprivkey||""==loginprivkey?"null"==loginpubkey||null==loginpubkey||""==loginpubkey?displayContentBasedOnURLParameters():trylogin(loginpubkey):trylogin(loginprivkey):trylogin(loginmnemonic)}function getAndSetVersion(){fetch("/version").then(function(response){return response.text()}).then(function(version){console.log("member"+version);let ver_split=version.lastIndexOf(".");document.getElementById("version").innerHTML=version.substring(0,ver_split)+".<u>"+version.substring(ver_split+1)+"</u>"})}function trylogin(loginkey){try{login(loginkey),displayNotificationCount()}catch(error){return document.getElementById("loginerror").innerHTML=error.message,console.log(error),void updateStatus(error.message)}getAndPopulateTopicList(!1),displayContentBasedOnURLParameters()}function login(loginkey){loginkey=loginkey.trim();var publicaddress="";if("Valid mnemonic"==(new BITBOX.Mnemonic).validate(loginkey)){var newloginkey=(new BITBOX.Mnemonic).toKeypairs(loginkey,1,!1,"44'/0'/0'/0/")[0].privateKeyWIF;localStorageSet(localStorageSafe,"mnemonic",loginkey),mnemonic=loginkey,loginkey=newloginkey}if(loginkey.startsWith("L")||loginkey.startsWith("K")){let ecpair=(new BITBOX.ECPair).fromWIF(loginkey);publicaddress=(new BITBOX.ECPair).toLegacyAddress(ecpair),privkey=loginkey,document.getElementById("loginkey").value="",localStorageSet(localStorageSafe,"privkey",privkey)}else{if(loginkey.startsWith("5"))return document.getElementById("loginkey").value="",void alert("Uncompressed WIF not supported yet, please use a compressed WIF (starts with 'L' or 'K')");if(loginkey.startsWith("q"))publicaddress=(new BITBOX.Address).toLegacyAddress(loginkey);else if(loginkey.startsWith("b"))publicaddress=(new BITBOX.Address).toLegacyAddress(loginkey);else{if(!loginkey.startsWith("1")&&!loginkey.startsWith("3"))return void alert("Key not recognized, use a valid 12 word BIP39 seed phrase, or a compressed WIF (starts with 'L' or 'K')");(new BITBOX.Address).isLegacyAddress(loginkey)&&(publicaddress=loginkey)}}pubkey=publicaddress.toString(),qpubkey=(new BITBOX.Address).toCashAddress(pubkey),lastViewOfNotifications=Number(localStorageGet(localStorageSafe,"lastViewOfNotifications")),localStorageSet(localStorageSafe,"pubkey",pubkey),tq.addUTXOPool(pubkey,localStorageSafe),document.getElementById("loggedin").style.display="inline",document.getElementById("loggedout").style.display="none",getAndPopulateSettings();let style=localStorageGet(localStorageSafe,"style");void 0!=style&&null!=style&&changeStyle(style)}function createNewAccount(){login(mnemonic=(new BITBOX.Mnemonic).generate(128)),show("settingsanchor"),alert("Send a small amount of BCH to your address to start using your account. Remember to make a note of your private key to login again.")}function logout(){null!=localStorageSafe&&localStorageSafe.clear(),privkey="",pubkey="",mnemonic="",document.getElementById("loggedin").style.display="none",document.getElementById("loggedout").style.display="inline",show("loginbox")}function changeStyle(newStyle){-1!=newStyle.indexOf(".css")&&(newStyle="base"),localStorageSet(localStorageSafe,"style",newStyle);var cssArray=newStyle.split(" ");cssArray[0]?document.getElementById("pagestyle").setAttribute("href","css/"+cssArray[0]+".css"):document.getElementById("pagestyle").setAttribute("href","css/base.css"),cssArray[1]?document.getElementById("pagestyle2").setAttribute("href","css/"+cssArray[1]+".css"):document.getElementById("pagestyle2").setAttribute("href","css/none.css"),cssArray[2]?document.getElementById("pagestyle3").setAttribute("href","css/"+cssArray[2]+".css"):document.getElementById("pagestyle3").setAttribute("href","css/none.css")}function setAddonStyle(newStyle){newStyle&&document.getElementById("addonstyle").setAttribute("href","css/"+newStyle)}function refreshPool(){tq.utxopools[pubkey].refreshPool()}ShowdownConverter.setFlavor("github"),ShowdownConverter.setOption("simpleLineBreaks",!0),ShowdownConverter.setOption("simplifiedAutoLink",!0),ShowdownConverter.setOption("openLinksInNewWindow",!0),ShowdownConverter.setOption("ghMentions",!1),window.onbeforeunload=function(){if(tq.isTransactionInProgress())return"Are you sure? There are still transaction(s) in progress. They will be lost if you close the page or reload via the browser."};var lastViewOfNotifications=0;function displayNotificationCount(){getJSON(dropdowns.contentserver+"?action=alertcount&address="+pubkey+"&since="+lastViewOfNotifications).then(function(data){if(null!=data[0].count){var alertcount=Number(data[0].count),element=document.getElementById("alertcount");element.innerHTML=alertcount>0?alertcount:"",setTimeout(displayNotificationCount,6e4)}},function(status){console.log("Something is wrong:"+status),updateStatus(status)})}function getAndPopulateNotifications(start,limit,page,qaddress){show(page),document.getElementById(page).innerHTML=document.getElementById("loading").innerHTML,getJSON(dropdowns.contentserver+"?action="+page+"&address="+pubkey+"&qaddress="+qaddress+"&start="+start+"&limit="+limit).then(function(data){for(var navbuttons=getNavButtonsHTML(start,limit,page,"new",qaddress,"","getAndPopulateNotifications",data.length),contents="",i=0;i<data.length;i++)contents+=getHTMLForNotification(data[i],i+1+start,page,i);""==contents&&(contents="Nothing in this feed yet"),contents=getNotificationsTableHTML(contents,navbuttons),lastViewOfNotifications=parseInt((new Date).getTime()/1e3),localStorageSet(localStorageSafe,"lastViewOfNotifications",lastViewOfNotifications),document.getElementById("alertcount").innerHTML="",document.getElementById(page).innerHTML=contents,addStarRatings(data,page),listenForTwitFrameResizes(),window.scrollTo(0,0)},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}function getHTMLForNotification(data,rank,page,starindex){if(checkForMutedWords(data))return"";let type=ds(data.type),mainRatingID=starindex+page+ds(data.origin),postRatingID="";switch(type){case"page":return postRatingID=starindex+page+ds(data.raddress)+type,notificationItemHTML("page","📣&nbsp;",userHTML(data.origin,data.originname,mainRatingID,data.raterrating,16)+" "+postlinkHTML(data.txid,"mentioned you "),timeSince(Number(data.time)),getHTMLForPostHTML(data.rtxid,data.raddress,data.originname,data.rlikes,data.rdislikes,data.rtips,data.rfirstseen,data.rmessage,data.rroottxid,data.rtopic,data.rreplies,data.rgeohash,page,postRatingID,data.rlikedtxid,data.rlikeordislike,data.repliesroot,data.raterrating,starindex));case"reply":return postRatingID=starindex+page+ds(data.raddress)+type,notificationItemHTML("reply","💬&nbsp;",userHTML(data.origin,data.originname,mainRatingID,data.raterrating,16)+" "+postlinkHTML(data.txid,"replied")+" to your "+postlinkHTML(data.rretxid,"post"),timeSince(Number(data.time)),getHTMLForPostHTML(data.rtxid,data.raddress,data.originname,data.rlikes,data.rdislikes,data.rtips,data.rfirstseen,data.rmessage,data.rroottxid,data.rtopic,data.rreplies,data.rgeohash,page,postRatingID,data.rlikedtxid,data.rlikeordislike,data.repliesroot,data.raterrating,starindex));case"rating":var theRating=0;return null!=data.rating&&""!=data.rating&&(theRating=Number(data.rating)/64+1),theRating=Math.round(10*theRating)/10,notificationItemHTML("rating","⭐&nbsp;",userHTML(data.origin,data.originname,mainRatingID,data.raterrating,16)+" rated you as "+theRating+" stars, commenting ... "+escapeHTML(data.reason),timeSince(Number(data.time)),"");case"follow":return notificationItemHTML("follow","👩&nbsp;",userHTML(data.origin,data.originname,mainRatingID,data.raterrating,16)+" followed you ",timeSince(Number(data.time)),"");case"like":return postRatingID=starindex+page+ds(data.address)+type,notificationItemHTML("like","💗&nbsp;",userHTML(data.origin,data.originname,mainRatingID,data.raterrating,16)+" liked your "+postlinkHTML(data.likeretxid,"post")+" "+(Number(data.amount)>0?balanceString(Number(data.amount),!1):""),timeSince(Number(data.time)),getHTMLForPostHTML(data.ltxid,data.laddress,data.username,data.llikes,data.ldislikes,data.ltips,data.lfirstseen,data.lmessage,data.lroottxid,data.ltopic,data.lreplies,data.lgeohash,page,postRatingID,data.likedtxid,data.likeordislike,data.repliesroot,data.selfrating,starindex));case"unfollow":case"mute":case"unmute":case"dislike":break;default:return""}return""}function userHTML(address,name,ratingID,ratingRawScore,ratingStarSize){""==name&&(name=address.substring(0,10));var ret='<a href="#member?qaddress='+san(address)+'" onclick="showMember(\''+san(address)+'\')" class="hnuser">'+ds(name)+"</a> ";return ratingStarSize>0&&(ret+='<div data-ratingsize="'+Number(ratingStarSize)+'" data-ratingaddress="'+san(address)+'" data-ratingraw="'+Number(ratingRawScore)+'" id="rating'+ratingID+'"></div>'),ret}function postlinkHTML(txid,linktext){return'<a href="#thread?post='+san(txid)+'" onclick="showThread(\''+san(txid)+"')\">"+ds(linktext)+"</a>"}function getNavButtonsNewHTML(order,content,topicnameHOSTILE,filter,start,limit,page,qaddress,functionName,numberOfResults){var navbuttons='<div class="navbuttons">';return 0!=start&&(navbuttons+='<a class="next" href="#show?start='+(Number(start)-Number(numbers.results))+"&limit="+limit+"&order="+order+"&content="+content+"&filter="+filter+"&qaddress="+qaddress+"&topicname="+ds(encodeURIComponent(topicnameHOSTILE))+'" onclick="javascript:'+functionName+"('"+order+"','"+content+"','"+unicodeEscape(topicnameHOSTILE)+"','"+filter+"',"+(start-numbers.results)+","+limit+",'"+page+"','"+qaddress+"')\">"+___i18n("prev")+"</a> "),numberOfResults>numbers.results&&(navbuttons+='<a class="back" href="#show?start='+(Number(start)+Number(numbers.results))+"&limit="+limit+"&order="+order+"&content="+content+"&filter="+filter+"&qaddress="+qaddress+"&topicname="+ds(encodeURIComponent(topicnameHOSTILE))+'" onclick="javascript:'+functionName+"('"+order+"','"+content+"','"+unicodeEscape(topicnameHOSTILE)+"','"+filter+"',"+(start+numbers.results)+","+limit+",'"+page+"','"+qaddress+"')\">"+___i18n("next")+"</a>"),navbuttons}function getNavButtonsHTML(start,limit,page,type,qaddress,topicName,functionName,numberOfResults){var navbuttons='<div class="navbuttons">';return 0!=start&&(navbuttons+='<a class="next" href="#'+page+"?start="+(Number(start)-Number(numbers.results))+"&limit="+limit+"&type="+type+"&qaddress="+qaddress+"&topicname="+ds(encodeURIComponent(topicName))+'" onclick="javascript:'+functionName+"("+(start-numbers.results)+","+limit+",'"+page+"','"+qaddress+"','"+type+"','"+unicodeEscape(topicName)+"')\">"+___i18n("prev")+"</a> "),numberOfResults>numbers.results&&(navbuttons+='<a class="back" href="#'+page+"?start="+(Number(start)+Number(numbers.results))+"&limit="+limit+"&type="+type+"&qaddress="+qaddress+"&topicname="+ds(encodeURIComponent(topicName))+'" onclick="javascript:'+functionName+"("+(start+numbers.results)+","+limit+",'"+page+"','"+qaddress+"','"+type+"','"+unicodeEscape(topicName)+"')\">"+___i18n("next")+"</a>"),navbuttons}function getItemListandNavButtonsHTML(contentsHTML,navbuttonsHTML,styletype,start){return""!=styletype?'<div class="itemlist"><ol start="'+(Number(start)+1)+'" class="'+styletype+'">'+contentsHTML+'</ol></div><div class="navbuttons">'+navbuttonsHTML+"</div>":'<div class="itemlist">'+contentsHTML+'</div><div class="navbuttons">'+navbuttonsHTML+"</div>"}function getDivClassHTML(className,contentsHTML){return'<div class="'+className+'">'+contentsHTML+"</div>"}function getVoteButtons(txid,address,likedtxid,likeordislike,score){var upvoteHTML;let scoreHTML='<span class="betweenvotesscore" id="score'+san(txid)+'">'+Number(score)+"</span>";var downvoteHTML;return"1"==likeordislike?(upvoteHTML='<a id="upvoteaction'+san(txid)+'" href="javascript:;"><span id="upvote'+san(txid)+'" class="votearrowactivated" title="upvote"></span><span class="votetext">up</span></a>',scoreHTML='<span class="betweenvotesscoreup" id="score'+san(txid)+'">'+Number(score)+"</span>"):upvoteHTML='<a id="upvoteaction'+san(txid)+'" href="javascript:;" onclick="likePost(\''+san(txid)+"','"+san(address)+'\')"><span id="upvote'+san(txid)+'" class="votearrow" title="upvote"></span><span class="votetext">up</span></a>',"-1"==likeordislike?(downvoteHTML='<a id="downvoteaction'+san(txid)+'" href="javascript:;"><span id="downvote'+san(txid)+'" class="votearrowactivateddown rotate180" title="downvote"><span class="votetext">down</span></span></a>',scoreHTML='<span class="betweenvotesscoredown" id="score'+san(txid)+'">'+Number(score)+"</span>"):downvoteHTML='<a id="downvoteaction'+san(txid)+'" href="javascript:;" onclick="dislikePost(\''+san(txid)+'\')"><span id="downvote'+san(txid)+'" class="votearrow rotate180" title="downvote"><span class="votetext">down</span></span></a>',upvoteHTML+" "+scoreHTML+" "+downvoteHTML}function getReplyDiv(txid,page,differentiator){return'\n        <div id="reply'+(page+=differentiator)+san(txid)+'" style="display:none">\n            <br/>\n            <textarea id="replytext'+page+san(txid)+'" rows="3"></textarea>\n            <br/>\n            <input id="replybutton'+page+san(txid)+'" value="'+___i18n("reply").toLowerCase()+'" type="submit" onclick="sendReply(\''+san(txid)+"','"+page+"','replystatus"+page+san(txid)+'\');"/>\n            <input id="replystatus'+page+san(txid)+'" value="sending..." type="submit"  style="display:none" disabled/>\n            <div id="replycompleted'+page+san(txid)+'" value=""></div>\n        </div>'}function getReplyAndTipLinksHTML(page,txid,address,article,geohash,differentiator,topicHOSTILE){page+=differentiator;var santxid=san(txid),articleLink="",mapLink="";article&&(articleLink='<a id="articlelink'+page+santxid+'" href="?'+santxid.substring(0,4)+"#article?post="+santxid.substring(0,10)+'">article</a> '),""!=geohash&&(mapLink=' <a id="maplink'+page+santxid+'" onclick="showMap(\''+san(geohash)+"','"+santxid+'\');" href="javascript:;">🌍map</a> ');var hideuserHTML="";return""!=topicHOSTILE&&(hideuserHTML='<a id="hideuserlink'+page+santxid+'" onclick="hideuser(\''+san(address)+"','"+unicodeEscape(topicHOSTILE)+"','hideuserlink"+page+santxid+'\');" href="javascript:;">hide(user for topic)</a>'),'\n        <a id="permalink'+page+santxid+'" href="?'+santxid.substring(0,4)+"#thread?post="+santxid.substring(0,10)+'">permalink</a> '+articleLink+mapLink+'<a id="replylink'+page+santxid+'" onclick="showReplyBox(\''+page+santxid+'\');" href="javascript:;"> '+___i18n("reply").toLowerCase()+'</a>\n        <a id="tiplink'+page+santxid+'" onclick="showTipBox(\''+page+santxid+'\');" href="javascript:;">tip</a>\n        <a  id="morelink'+page+santxid+'" onclick="showMore(\'more'+page+santxid+"','morelink"+page+santxid+'\');" href="javascript:;">+more</a>\n        <span id="more'+page+santxid+'" style="display:none">\n        <a rel="noopener noreferrer" target="memo" href="https://memo.cash/a/'+santxid+'">memo</a>\n            <a rel="noopener noreferrer" target="bitcoincom" href="https://explorer.bitcoin.com/bch/tx/'+santxid+'">bitcoin.com</a>\n            <a rel="noopener noreferrer" target="blockchair" href="https://blockchair.com/bitcoin-cash/transaction/'+santxid+'">blockchair</a>\n        </span>\n\n        <a  id="moderatelink'+page+santxid+'" onclick="showMore(\'moderate'+page+santxid+"','moderatelink"+page+santxid+'\');" href="javascript:;">+moderate</a>\n        <span id="moderate'+page+santxid+'" style="display:none">\n            <a id="hidepostlink'+page+santxid+'" onclick="sendHidePost(\''+santxid+'\');" href="javascript:;">hide(post)</a>'+hideuserHTML+'</span>\n\n        <span id="tipbox'+page+santxid+'" style="display:none">\n            <input id="tipamount'+page+santxid+'" type="number" value="0" min="0" style="width: 6em;" step="1000"/>\n            <input id="tipbutton'+page+santxid+'" value="tip" type="submit" onclick="sendTip(\''+santxid+"','"+san(address)+"','"+page+'\');"/>\n            <input id="tipstatus'+page+santxid+'"value="sending" type="submit" style="display:none" disabled/>\n        </span>'}function getScoresHTML(txid,likes,dislikes,tips){return' <span class="score"><span class="likescounttext"><span id="likescount'+san(txid)+'">'+(Number(likes)-Number(dislikes))+'</span> likes and</span> <span class="tipscounttext"><span id="tipscount'+san(txid)+'"  data-amount="'+Number(tips)+'">'+balanceString(Number(tips),!1)+"</span></span></span>"}function getAgeHTML(firstseen,compress){return'<span class="age">'+timeSince(Number(firstseen),compress)+"</span>"}function getTopicHTML(topic,append){return' <span class="topic">'+(""==topic?"":'<a href="#topic?topicname='+encodeURIComponent(topic)+"&start=0&limit="+numbers.results+'&order=new" onclick="showTopic(0,numbers.results,\''+unicodeEscape(topic)+"','new')\">"+append+capitalizeFirstLetter(ds(topic).substr(0,40))+"</a> ")+"</span>"}function getPostListItemHTML(postHTML){return""==postHTML?"":"<li>"+postHTML+"</li>"}function getHTMLForPostHTML(txid,address,name,likes,dislikes,tips,firstseen,message,roottxid,topic,replies,geohash,page,ratingID,likedtxid,likeordislike,repliesroot,rating,differentiator){null==name&&(name=address.substring(0,10)),repliesroot=Number(repliesroot),replies=Number(replies);var isReply=roottxid!=txid,messageHTML=ds(message);isReply?messageHTML=messageHTML.replace(/(?:\r\n|\r|\n)/g,"<br>"):repliesroot>replies&&(replies=repliesroot);var messageLinksHTML=anchorme(messageHTML,{attributes:[{name:"target",value:"_blank"}]});return-1==(messageLinksHTML=addImageAndYoutubeMarkdown(messageLinksHTML=DOMPurify.sanitize(messageLinksHTML),differentiator)).indexOf("<a ")&&-1==messageLinksHTML.indexOf("<iframe ")&&(messageLinksHTML='<a href="#thread?root='+san(roottxid)+"&post="+san(txid)+'" onclick="showThread(\''+san(roottxid)+"','"+san(txid)+"')\">"+messageLinksHTML+"</a>"),'<div class="post">\n                <div class="votelinks">'+getVoteButtons(txid,address,likedtxid,likeordislike,Number(likes)-Number(dislikes))+'</div>\n                <div class="postdetails">\n                    <div class="title">'+messageLinksHTML+' </div>\n                    <div class="subtext">\n                        <span class="submitter"> \n                        submitted  '+getAgeHTML(firstseen)+" "+___i18n("by")+" "+userHTML(address,name,ratingID,rating,8)+getTopicHTML(topic,"to topic/")+'</span><span class="subtextbuttons"><a href="#thread?root='+san(roottxid)+"&post="+san(txid)+'" onclick="showThread(\''+san(roottxid)+"','"+san(txid)+"')\">"+Math.max(0,Number(replies))+"&nbsp;"+___i18n("comments").toLowerCase()+"</a> "+getScoresHTML(txid,likes,dislikes,tips)+" "+getReplyAndTipLinksHTML(page,txid,address,!0,geohash,differentiator,topic)+"</span>\n                    </div>"+getReplyDiv(txid,page,differentiator)+"\n                </div>\n            </div>"}function dslite(input){try{input=(input=(input=input.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#x27;")}catch(e){return""}return input}function getHTMLForReplyHTML(txid,address,name,likes,dislikes,tips,firstseen,message,depth,page,ratingID,highlighttxid,likedtxid,likeordislike,blockstxid,rating,differentiator,topicHOSTILE){return null==name&&(name=address.substring(0,10)),message=dslite(message),message=ShowdownConverter.makeHtml(message),message=addImageAndYoutubeMarkdown(message=DOMPurify.sanitize(message),differentiator),"<div "+(txid.startsWith(highlighttxid)?'class="reply highlight" id="highlightedcomment"':'class="reply"')+">\n                <div"+(null!=blockstxid?' class="blocked"':"")+'>\n                    <div class="votelinks">'+getVoteButtons(txid,address,likedtxid,likeordislike)+'</div>\n                    <div class="commentdetails">\n                        <div class="comhead"> <a onclick="collapseComment(\''+san(txid)+'\');" href="javascript:;">[-]</a> '+userHTML(address,name,ratingID,rating,8)+getScoresHTML(txid,likes,dislikes,tips)+" "+getAgeHTML(firstseen)+'</div>\n                        <div class="comment"><div class="commentbody">\n                            '+message+'\n                            </div><div class="subtextbuttons">'+getReplyAndTipLinksHTML(page,txid,address,!1,"",differentiator,topicHOSTILE)+"</div>\n                            "+getReplyDiv(txid,page,differentiator)+"\n                        </div>\n                    </div>\n                </div>\n            </div>\n            "}function makeYoutubeIframe(youtubeid,starttime){event.srcElement.parentElement.parentElement.parentElement.parentElement.innerHTML='<iframe width="480" height="270" class="youtubeiframe" src="https://www.youtube.com/embed/'+sanyoutubeid(youtubeid)+"?rel=0&autoplay=1&showinfo=0&start="+starttime+'" frameborder="0"></iframe>'}function addImageAndYoutubeMarkdown(message,differentiator){if("true"==settings.showyoutube&&(message=message.replace(/<a.*(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/.*(?:watch|embed)?(?:.*v=|v\/|\/)([\w\-_]{7,12})(?:[\&\?\#].*?)*?(?:([\&\?\#]t=)?(([\dhms]+))?).*<\/a>/g,'<div class="youtubecontainer"><div class="youtubepreviewimage"><a onclick="makeYoutubeIframe(\'$1\',\'$4\');"><div class="youtubepreview"><img height="270" class="youtubepreviewimage" src="https://img.youtube.com/vi/$1/0.jpg"><img class="play-icon" alt="video post" width="100" src="img/youtubeplaybutton.svg"></div></a></div></div>')),"true"==settings.showimgur&&(message=message.replace(/<a.*(?:https?:\/\/)?(\w+\.)?imgur\.com(\/|\/a\/|\/gallery\/)(?!gallery)([\w\-_]{5,12})(\.[a-zA-Z]{3})*.*<\/a>/g,'<a href="https://i.imgur.com$2$3" rel="noopener noreferrer" target="_imgur"><div class="imgurcontainer"><img class="imgurimage"  src="https://i.imgur.com$2$3.jpg" alt="imgur post $2"></div></a>')),"true"==settings.showtwitter){message=message.replace(/<a.*https?:\/\/twitter\.com\/(?:#!\/)?(\w+)\/status(es)?\/([0-9]{19})*.*<\/a>/,'<div class="twittercontainer"><iframe  height="400" width="550" class="twitteriframe" id="tweet_$3'+differentiator+'" border=0 frameborder=0  src="https://twitframe.com/show?url=https%3A%2F%2Ftwitter.com%2F$1%2Fstatus%2F$3"></iframe></div>')}return message}function notificationItemHTML(notificationtype,iconHTML,mainbodyHTML,subtextHTML,addendumHTML){return'\n    <li class="notificationitem notification'+notificationtype+'">\n        <div class="notificationdetails">\n        <div class="notificationminheight">\n            <div class="notificationtitle">'+mainbodyHTML+'\n                <span class="age">'+subtextHTML+"</span>\n            </div>"+addendumHTML+'</div><hr class="notificationhr"/>\n        </div>       \n    </li>'}function getMapPostHTML(lat,lng,requireLogin){var loginRequired="";return requireLogin&&(loginRequired=' <a href="#login" onclick="showLogin();">(Login Required)</a>'),'\n    <div id="newgeopost" class="bgcolor">\n        <input id="lat" size="10" type="hidden" value="'+Number(lat)+'">\n        <input id="lon" size="10" type="hidden" value="'+Number(lng)+'">\n        <input id="geohash" size="15" type="hidden">\n        <textarea class="geoposttextarea" id="newgeopostta" maxlength="217" name="text" rows="4"></textarea><br/>\n        <input id="newpostgeobutton" value="Post" type="submit" onclick="geopost();">'+loginRequired+'<input id="newpostgeostatus" style="display: none;" value="Sending . . ." type="submit" disabled>\n        <div id="newpostgeocompleted"></div>    \n    </div>'}function getRefreshButtonHTML(){return'<a id="refreshbutton" class="btn" href="" onclick="displayContentBasedOnURLParameters();return false;">🔄</a>'}function getMembersWithRatingHTML(i,page,data,action,reverse){var field1="<td>"+userHTML(data.address,data.name,i+page+data.address,data.rating,8)+"</td>",field2="<td>"+getMemberLink(data.address2,data.name2)+"</td>";return reverse?"<tr>"+field2+"<td>"+action+"</td>"+field1+"</tr>":"<tr>"+field1+"<td>"+action+"</td>"+field2+"</tr>"}function getMemberLink(address,name){return'<a href="#member?qaddress='+san(address)+'" onclick="showMember(\''+san(address)+"')\">"+ds(name)+"</a>"}function getAddressLink(address,name){return'<a href="#member?qaddress='+san(address)+'" onclick="showMember(\''+san(address)+"')\">"+san(address)+"</a>"}function getBootStrapHTML(pubkey,data,lbstcount){return"<tr><td>"+getMemberLink(pubkey,data.ratername)+"</td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td></td><td></td><td align='center'> <div id='rating"+lbstcount+san(data.testaddress)+"'></div>  </td><td></td><td></td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td>"+getMemberLink(data.testaddress,data.name)+"</td><td><a href='#trustgraph?member="+san(pubkey)+"&amp;target="+san(data.testaddress)+"' onclick='showTrustGraph(\""+san(pubkey)+'","'+san(data.testaddress)+"\");'>Full Trust Graph</a></td></tr>"}function getMapCloseButtonHTML(){return'<font size="+3"><a href="#posts?type=all&amp;start=0&amp;limit='+numbers.results+'" onclick="hideMap();showPosts(0,numbers.results,\'all\');">X</a></font>'}function getOSMattributionHTML(){return'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.'}function mapThreadLoadingHTML(previewHTML){return"<div id='mapthread'>Loading..."+previewHTML+"</div>"}function escapeHTML(thetext){return ds(thetext)}function getNotificationsTableHTML(contents,navbuttons){return'<ul class="notificationslist">'+contents+"</ul>"+navbuttons}function getDirectRatingHTML(data){return"<tr><td>"+getMemberLink(data.member,data.membername)+"</td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td></td><td></td><td align='center'> <div id='trust"+san(data.member)+san(data.target)+"'></div>  </td><td></td><td></td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td>"+getMemberLink(data.target,data.targetname)+"</td></tr>"}function getIndirectRatingHTML(data){return"<tr><td>"+getMemberLink(data.member,data.membername)+"</td><td><img height='16' width='16' src='img/rightarrow.png'/></td><td> <div id='trust"+san(data.member)+san(data.inter)+"'></div> </td><td><img height='16' width='16' src='img/rightarrow.png'/></td><td align='center'>"+getMemberLink(data.inter,data.intername)+"</td><td><img height='16' width='16' src='img/rightarrow.png'/></td><td> <div id='trust"+san(data.inter)+san(data.target)+"'> </div> </td><td><img height='16' width='16' src='img/rightarrow.png'/></td><td>"+getMemberLink(data.target,data.targetname)+"</td></tr>"}function getTrustRatingTableHTML(contentsHTML,rating){return"<span style='font-size:2em'>Overall Rating:"+Number(rating)+"/5.0</span><div id='overall'></div><br/><br/><table>"+contentsHTML+"</table>"}function rts(thetext){return san(thetext)}function ratingAndReasonHTML(data){return"<tr><td>"+getMemberLink(data.address,data.name)+"</td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td></td><td></td><td align='center'> <div id='crating"+san(data.address)+"'></div>  </td><td></td><td></td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td>"+getMemberLink(data.rates,data.rateename)+"</td><td><span class='separatornarrow'></span></td><td>"+ds(data.reason)+"</td></tr>"}function ratingAndReason2HTML(data){return"<tr><td>"+getMemberLink(data.rateraddress,data.ratername)+"</td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td></td><td></td><td align='center'> <div id='rating"+san(data.rates)+"'></div>  </td><td></td><td></td><td align='center'><img height='24' width='24' src='img/rightarrow.png'/></td><td>"+getMemberLink(data.rates,data.name)+"</td><td><span class='separatornarrow'></span></td><td>"+ds(data.reason)+"</td></tr>"}function clickActionNamedHTML(action,qaddress,name){return"<a href='javascript:;' onclick='"+action+'("'+unicodeEscape(qaddress)+"\");'>"+ds(name)+"</a>"}function clickActionTopicHTML(action,qaddress,topicHOSTILE,buttonText,elementid){return"<a id='"+san(elementid)+"' href='javascript:;' onclick='"+action+'("'+unicodeEscape(qaddress)+'","'+unicodeEscape(topicHOSTILE)+'","'+san(elementid)+"\");'>"+ds(buttonText)+"</a>"}function getRatingComment(qaddress,data){return'<input size="30" maxlength="210" id="memberratingcommentinputbox'+san(qaddress)+'" value="'+(data.length>0?ds(data[0].ratingreason):"")+'" onkeypress="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();"></input>'}function privatekeyClickToShowHTML(){return"<a id=\"privatekeyclicktoshow\" onclick=\"document.getElementById('privatekeydisplay').style.display='block';document.getElementById('privatekeyclicktoshow').style.display='none';\">"+___i18n("text")+"</a>"}function getNestedPostHTML(data,targettxid,depth,pageName,highlighttxid,firstreplytxid){for(var contents="<ul>",i=0;i<data.length;i++)data[i].retxid!=targettxid&&data[i].retxid!=firstreplytxid||data[i].txid==firstreplytxid||(contents+='<li id="LI'+san(data[i].txid)+'"'+(data[i].txid.startsWith(highlighttxid)?'class="highlightli" ':"")+">"+getHTMLForReply(data[i],depth,pageName,i,highlighttxid)+getNestedPostHTML(data,data[i].txid,depth+1,pageName,highlighttxid,"dontmatch")+"</li>",contents+='<li class="collapsed" style="display: none;" id="CollapsedLI'+san(data[i].txid)+'"><div class="comhead"><a onclick="uncollapseComment(\''+san(data[i].txid)+'\');" href="javascript:;">[+] </a>'+userHTML(data[i].address,data[i].name,data[i].ratingID,data[i].rating,0)+getScoresHTML(data[i].txid,data[i].likes,data[i].dislikes,data[i].tips)+" "+getAgeHTML(data[i].firstseen)+"</div></li>");return contents+="</ul>"}function getHTMLForTopicArray(data){var ret=getHTMLForTopic(data[0]);ret+="<tr style='display:none'></tr>",ret+="<tr style='display:none' id='modmore"+data[0].mostrecent+"'><td colspan='4'>",ret+=clickActionNamedHTML("unsub",data.topicname,"Unsubscribe")+"<br/>";for(var alreadymod=!1,i=0;i<data.length;i++)data[i].existingmod==pubkey&&(ret+=clickActionTopicHTML("dismiss",pubkey,data[i].topicname,"Resign as moderator","dismiss"+Number(data[i].mostrecent))+"<br/>",alreadymod=!0);alreadymod||(ret+=clickActionTopicHTML("designate",pubkey,data[0].topicname,"Volunteer to moderate","designate"+Number(data[0].mostrecent))+"<br/>");for(i=0;i<data.length;i++)data[i].existingmod!=pubkey&&null!=data[i].existingmod&&(null!=data[i].existingmodaddress?ret+=clickActionTopicHTML("dismiss",data[i].existingmod,data[i].topicname,"Dismiss a moderator ","dismiss"+data[i].existingmod+Number(data[i].mostrecent))+"( "+userHTML(data[i].existingmod,data[i].existingmodname,"","",0)+")<br/>":ret+=clickActionTopicHTML("designate",data[i].existingmod,data[i].topicname,"Appoint a moderator ","designate"+data[i].existingmod+Number(data[i].mostrecent))+"( "+userHTML(data[i].existingmod,data[i].existingmodname,"","",0)+")<br/>");return ret+="</td></tr>"}function getHTMLForTopic(data){var ret="",subscribe=clickActionNamedHTML("sub",data.topicname,"sub");return null!=data.address&&""!=data.address&&(subscribe='<a id="modmorelink'+data.mostrecent+'" onclick="showMore(\'modmore'+data.mostrecent+"','modmorelink"+data.mostrecent+'\');" href="javascript:;">more</a>'),ret+="<tr><td class='tltopicname'>"+getTopicHTML(data.topicname,"")+"</td><td class='tlmessagecount'>"+Number(data.messagescount)+"</td><td class='tlsubscount'>"+Number(data.subscount)+"</td><td class='tlaction'>"+subscribe+"</td></tr>"}function collapseComment(commentid){document.getElementById("LI"+commentid).style.display="none",document.getElementById("CollapsedLI"+commentid).style.display="block"}function uncollapseComment(commentid){document.getElementById("LI"+commentid).style.display="block",document.getElementById("CollapsedLI"+commentid).style.display="none"}var globalusersearchtimeoutcount=0;async function userSearchChanged(){var searchtermHOSTILE=document.getElementById("usersearch").value;if(!(searchtermHOSTILE.length<3)){var localCountTimeOut=++globalusersearchtimeoutcount;document.getElementById("usersearchresults").innerHTML=document.getElementById("loading").innerHTML,await sleep(500),localCountTimeOut==globalusersearchtimeoutcount&&getJSON(dropdowns.contentserver+"?action=usersearch&address="+pubkey+"&searchterm="+encodeURIComponent(searchtermHOSTILE)).then(function(data){for(var contents="",i=0;i<data.length;i++)contents=contents+userHTML(data[i].address,data[i].name,i+"usersearch"+data[i].address,data[i].rating,16)+"<br/>";document.getElementById("usersearchresults").innerHTML=contents,addStarRatings(data,"usersearch")},function(status){console.log("Something is wrong:"+status),document.getElementById(page).innerHTML="Something is wrong:"+status,updateStatus(status)})}}